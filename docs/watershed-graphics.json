{"version":3,"kind":"Notebook","sha256":"5451951509a9058ef53b3f827e50510b713c21b9019a9a0b7dc9419f568c0d28","slug":"watershed-graphics","location":"/Watershed_Graphics.ipynb","dependencies":[],"frontmatter":{"title":"Watershed Study Area","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"id":"Matthew Duus","name":"Matthew Duus"}],"exports":[{"format":"ipynb","filename":"Watershed_Graphics.ipynb","url":"/red-tide-book//build/Watershed_Graphics-c57eb276dec8b291cd17bcacb088e603.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1. Caloosahatchee Watershed Boundary Extraction","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xnWtEtMOMz"}],"identifier":"id-1-caloosahatchee-watershed-boundary-extraction","label":"1. Caloosahatchee Watershed Boundary Extraction","html_id":"id-1-caloosahatchee-watershed-boundary-extraction","implicit":true,"key":"mn1OXtpwWj"}],"key":"X2diC0wqtd"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The Caloosahatchee River watershed boundary was obtained from the USGS Watershed Boundary Dataset (WBD) by querying the hydrologic unit corresponding to HUC-8 03090205. The resulting polygon defines the official extent of the Caloosahatchee basin and serves as the spatial framework for subsequent mapping and analysis.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TptWr69dqq"}],"key":"LxRKbf0xC4"}],"key":"C6w30pDxD9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import geopandas as gpd\n\nwbd_url = (\n    \"https://hydro.nationalmap.gov/arcgis/rest/services/wbd/MapServer/4/\"\n    \"query?where=HUC8%3D%2703090205%27&outFields=*&f=geojson\"\n)\n\ncaloosa = gpd.read_file(wbd_url)\n\nprint(caloosa.crs)   # just to see what it is\n\ncaloosa.plot(edgecolor=\"black\", facecolor=\"none\")","key":"SEenzdSDbg"},{"type":"outputs","id":"lQEVZn5rwVlJqhSeESqmG","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"EPSG:4326\n"},"children":[],"key":"rM0AmxIxZC"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":1,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},"children":[],"key":"pW7SqOlTXe"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"015068ce12797aea21624c166b0bbd9a","path":"/red-tide-book//build/015068ce12797aea21624c166b0bbd9a.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"laRqMInISA"}],"key":"uKuPI3HYhW"}],"key":"dfkIloF78l"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2. Caloosahatchee River Flowline Extraction","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jsBkxj23WZ"}],"identifier":"id-2-caloosahatchee-river-flowline-extraction","label":"2. Caloosahatchee River Flowline Extraction","html_id":"id-2-caloosahatchee-river-flowline-extraction","implicit":true,"key":"TEapPYz1to"}],"key":"ClFS0KtnOU"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The main stem of the Caloosahatchee River was extracted from the USGS National Hydrography Dataset (NHD) using a name-based query of the NHD Flowline (Large Scale) layer. All polyline features associated with the “Caloosahatchee” GNIS name were retrieved, providing an accurate representation of the river’s course through the watershed.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q7r1ssMDAW"}],"key":"UvABra6xZW"}],"key":"hIICfNAwYg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import geopandas as gpd\n\n# NHD Flowline - Large Scale (layer 6), search by name\nnhd_url = (\n    \"https://hydro.nationalmap.gov/arcgis/rest/services/nhd/MapServer/6/\"\n    \"query?where=gnis_name%20LIKE%20%27Caloosahatchee%25%27&outFields=*&f=geojson\"\n)\n\nriver = gpd.read_file(nhd_url)\n\nprint(\"River CRS:\", river.crs)\nprint(\"Number of features:\", len(river))\n\nif len(river) > 0:\n    ax = river.plot(color=\"deepskyblue\", linewidth=1)\nelse:\n    print(\"No features returned – name query didn't find anything.\")","key":"rocDCB1cZn"},{"type":"outputs","id":"V1zCUVuDebsM0tuCgDZmX","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"River CRS: EPSG:4326\nNumber of features: 268\n"},"children":[],"key":"AlN1ZG9O8c"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2d4937009af155fa8f8d70451e9629bb","path":"/red-tide-book//build/2d4937009af155fa8f8d70451e9629bb.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"vktYPnR5EG"}],"key":"LC9DFd1zdf"}],"key":"Mr4FEgyGVf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pip install contextily","key":"ENTx9vWr14"},{"type":"outputs","id":"qnpTpm3dixIcMFrJNwL-1","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Requirement already satisfied: contextily in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (1.6.2)\nRequirement already satisfied: geopy in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from contextily) (2.4.1)\nRequirement already satisfied: matplotlib in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from contextily) (3.10.0)\nRequirement already satisfied: mercantile in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from contextily) (1.2.1)\nRequirement already satisfied: pillow in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from contextily) (11.1.0)\nRequirement already satisfied: rasterio in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from contextily) (1.4.3)\nRequirement already satisfied: requests in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from contextily) (2.32.3)\nRequirement already satisfied: joblib in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from contextily) (1.4.2)\nRequirement already satisfied: xyzservices in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from contextily) (2024.9.0)\nRequirement already satisfied: geographiclib<3,>=1.52 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from geopy->contextily) (2.0)\nRequirement already satisfied: contourpy>=1.0.1 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from matplotlib->contextily) (1.3.1)\nRequirement already satisfied: cycler>=0.10 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from matplotlib->contextily) (0.12.1)\nRequirement already satisfied: fonttools>=4.22.0 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from matplotlib->contextily) (4.55.3)\nRequirement already satisfied: kiwisolver>=1.3.1 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from matplotlib->contextily) (1.4.8)\nRequirement already satisfied: numpy>=1.23 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from matplotlib->contextily) (2.2.1)\nRequirement already satisfied: packaging>=20.0 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from matplotlib->contextily) (24.1)\nRequirement already satisfied: pyparsing>=2.3.1 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from matplotlib->contextily) (3.2.1)\nRequirement already satisfied: python-dateutil>=2.7 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from matplotlib->contextily) (2.9.0.post0)\nRequirement already satisfied: click>=3.0 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from mercantile->contextily) (8.1.8)\nRequirement already satisfied: affine in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from rasterio->contextily) (2.4.0)\nRequirement already satisfied: attrs in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from rasterio->contextily) (24.3.0)\nRequirement already satisfied: certifi in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from rasterio->contextily) (2024.8.30)\nRequirement already satisfied: cligj>=0.5 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from rasterio->contextily) (0.7.2)\nRequirement already satisfied: click-plugins in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from rasterio->contextily) (1.1.1)\nRequirement already satisfied: charset-normalizer<4,>=2 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from requests->contextily) (3.3.2)\nRequirement already satisfied: idna<4,>=2.5 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from requests->contextily) (3.7)\nRequirement already satisfied: urllib3<3,>=1.21.1 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from requests->contextily) (2.2.3)\nRequirement already satisfied: colorama in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from click>=3.0->mercantile->contextily) (0.4.6)\nRequirement already satisfied: six>=1.5 in c:\\users\\mkduu\\miniconda3\\lib\\site-packages (from python-dateutil>=2.7->matplotlib->contextily) (1.17.0)\nNote: you may need to restart the kernel to use updated packages.\n"},"children":[],"key":"nYfkODyY4z"}],"key":"RhHxUqcoQB"}],"key":"ImuW3D64of"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3. Monitoring Stations, Coordinate Transformation, and Map Generation (Caloosahatchee)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OUfLROoF4A"}],"identifier":"id-3-monitoring-stations-coordinate-transformation-and-map-generation-caloosahatchee","label":"3. Monitoring Stations, Coordinate Transformation, and Map Generation (Caloosahatchee)","html_id":"id-3-monitoring-stations-coordinate-transformation-and-map-generation-caloosahatchee","implicit":true,"key":"oNbNYtYfYs"}],"key":"HnmcIdUqcv"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Monitoring station coordinates were compiled and converted into a geospatial dataset for inclusion on the study-area map. All spatial layers—including the watershed boundary, river flowline, and station locations—were reprojected to the Web Mercator coordinate system (EPSG:3857) to ensure compatibility with the OpenStreetMap basemap. These layers were then combined to generate a composite map of the Caloosahatchee watershed, providing a clear visualization of the basin, the river’s course, and the associated monitoring locations.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TroNCTIdLN"}],"key":"XiZpAUMO1m"}],"key":"oGqlPFlvqC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import geopandas as gpd\nimport matplotlib.pyplot as plt\nfrom shapely.geometry import Point\nimport contextily as cx\nimport matplotlib.lines as mlines\n\n# -----------------------------------------------------------\n# 1. STATION LOCATIONS (EDIT COORDS AS NEEDED)\n# -----------------------------------------------------------\nstations_data = [\n    {\"name\": \"S-79 NEAR OLGA\",        \"lon\": -81.7760, \"lat\": 26.7150},\n    {\"name\": \"CALOOSAHATCHEE BRIDGE\", \"lon\": -81.8780, \"lat\": 26.6400},\n    {\"name\": \"DEEP LAGOON\",           \"lon\": -81.9530, \"lat\": 26.5600},\n]\n\nstations = gpd.GeoDataFrame(\n    stations_data,\n    geometry=[Point(d[\"lon\"], d[\"lat\"]) for d in stations_data],\n    crs=\"EPSG:4326\"\n)\n\n# -----------------------------------------------------------\n# 2. PROJECT EVERYTHING TO WEB MERCATOR FOR BASEMAP\n# -----------------------------------------------------------\ntarget_crs = \"EPSG:3857\"\n\ncaloosa_3857 = caloosa.to_crs(target_crs)\nriver_3857   = river.to_crs(target_crs)\nstations_3857 = stations.to_crs(target_crs)\n\n# -----------------------------------------------------------\n# 3. START FIGURE\n# -----------------------------------------------------------\nfig, ax = plt.subplots(figsize=(4, 6), dpi=300)\n\n# Watershed outline\ncaloosa_3857.boundary.plot(ax=ax, color=\"black\", linewidth=1)\n\n# River line\nriver_3857.plot(ax=ax, color=\"deepskyblue\", linewidth=2)\n\n# Stations\nstations_3857.plot(ax=ax, color=\"blue\", markersize=25)\n\n# -----------------------------------------------------------\n# 4. PER-STATION LABEL OFFSETS (for cleaner labeling)\n# -----------------------------------------------------------\noffsets = {\n    \"S-79 NEAR OLGA\":        ( 2000,  700),\n    \"CALOOSAHATCHEE BRIDGE\": ( 2000,    0),\n    \"DEEP LAGOON\":           ( 2000, -800),\n}\n\nfor x, y, label in zip(\n        stations_3857.geometry.x,\n        stations_3857.geometry.y,\n        stations_3857[\"name\"]):\n    \n    dx, dy = offsets.get(label, (500, 500))\n    \n    ax.text(\n        x + dx,\n        y + dy,\n        label,\n        fontsize=6,\n        color=\"navy\",\n    )\n\n# -----------------------------------------------------------\n# 5. BASEMAP + EXTENT + LEGEND\n# -----------------------------------------------------------\nxmin, ymin, xmax, ymax = caloosa_3857.total_bounds\npad = 5000   # meters of padding around bounding box\n\nax.set_xlim(xmin - pad, xmax + pad)\nax.set_ylim(ymin - pad, ymax + pad)\n\n# Add OpenStreetMap basemap\ncx.add_basemap(\n    ax,\n    source=cx.providers.OpenStreetMap.Mapnik,\n    crs=target_crs,\n    alpha=0.8\n)\n\n# Legend handles\nstation_handle = mlines.Line2D(\n    [], [], color=\"blue\", marker=\"o\", linestyle=\"None\",\n    markersize=5, label=\"Stations\"\n)\nriver_handle = mlines.Line2D(\n    [], [], color=\"deepskyblue\", linewidth=2,\n    label=\"Caloosahatchee River\"\n)\n\nax.legend(handles=[station_handle, river_handle],\n          loc=\"upper right\", fontsize=7, frameon=True)\n\n# Remove axes ticks\nax.set_xticks([])\nax.set_yticks([])\n\nplt.tight_layout()\n\n# -----------------------------------------------------------\n# 6. SAVE HIGH-RES EXPORT\n# -----------------------------------------------------------\nplt.savefig(\"caloosahatchee_watershed_map.png\", dpi=600, bbox_inches=\"tight\")\nplt.savefig(\n    \"caloosahatchee_watershed_map.png\",\n    dpi=600,\n    bbox_inches=\"tight\"\n)\nplt.savefig(\n    r\"C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Caloosahatchee watershed Graphics\\caloosahatchee_watershed_map.png\",\n    dpi=600,\n    bbox_inches=\"tight\"\n)\nplt.show()","key":"CxiTGKV880"},{"type":"outputs","id":"t5B3pV7qZIrsSKhi6D8IU","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6c267bd0d10aa418d138fcdec0290270","path":"/red-tide-book//build/6c267bd0d10aa418d138fcdec0290270.png"},"text/plain":{"content":"<Figure size 1200x1800 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"Cu9FpXdlNo"}],"key":"Kw9yCTFZgj"}],"key":"kMIbZNSosk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4. Peace River Watershed Boundary Extraction","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JKinOYLxhx"}],"identifier":"id-4-peace-river-watershed-boundary-extraction","label":"4. Peace River Watershed Boundary Extraction","html_id":"id-4-peace-river-watershed-boundary-extraction","implicit":true,"key":"c3anPa9m2W"}],"key":"PqIV5bGEC4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import geopandas as gpd\n\n# Peace River HUC-8 from USGS WBD\nwbd_url_peace = (\n    \"https://hydro.nationalmap.gov/arcgis/rest/services/wbd/MapServer/4/\"\n    \"query?where=HUC8%3D%2703100101%27&outFields=*&f=geojson\"\n)\n\npeace_ws = gpd.read_file(wbd_url_peace)\n\nprint(peace_ws.crs)\npeace_ws.plot(edgecolor=\"black\", facecolor=\"none\")\n","key":"naGMb4le3F"},{"type":"outputs","id":"IU1TB6zwk50O7Ia_vs7yj","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"EPSG:4326\n"},"children":[],"key":"xs8BxWrEbD"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},"children":[],"key":"QmBbsIw9RW"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"76c6879485b21afc35aa12a7254bfe1b","path":"/red-tide-book//build/76c6879485b21afc35aa12a7254bfe1b.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"EmGtdsE5v5"}],"key":"m9zDhfw9P2"}],"key":"gcfJ9YoHaB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"5. Peace River Flowline From NHD","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uGYL7uWN2K"}],"identifier":"id-5-peace-river-flowline-from-nhd","label":"5. Peace River Flowline From NHD","html_id":"id-5-peace-river-flowline-from-nhd","implicit":true,"key":"KCttwUqHOU"}],"key":"Ly4vnQ6LUT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import geopandas as gpd\n\n# ---------------------------------------------------------------------\n# 1. Peace River watershed boundary (HUC-8: 03100101)\n# ---------------------------------------------------------------------\nwbd_url_peace = (\n    \"https://hydro.nationalmap.gov/arcgis/rest/services/wbd/MapServer/4/\"\n    \"query?where=HUC8%3D%2703100101%27&outFields=*&f=geojson\"\n)\n\npeace_ws = gpd.read_file(wbd_url_peace)\nprint(\"Peace WS CRS:\", peace_ws.crs)\n\n# ---------------------------------------------------------------------\n# 2. Peace River flowlines from NHD (often returns extra junk)\n# ---------------------------------------------------------------------\nnhd_url_peace = (\n    \"https://hydro.nationalmap.gov/arcgis/rest/services/nhd/MapServer/6/\"\n    \"query?where=gnis_name%20LIKE%20%27Peace%20River%25%27&outFields=*&f=geojson\"\n)\n\npeace_river = gpd.read_file(nhd_url_peace)\nprint(\"Raw flowline features:\", len(peace_river))\n\n# ---------------------------------------------------------------------\n# 3. Clip flowlines to the watershed to remove stray segments\n# ---------------------------------------------------------------------\n# Ensure CRS matches\npeace_ws = peace_ws.to_crs(peace_river.crs)\n\npeace_river_clip = gpd.overlay(peace_river, peace_ws, how=\"intersection\")\nprint(\"Clipped flowline features:\", len(peace_river_clip))\n\n# ---------------------------------------------------------------------\n# 4. Plot result\n# ---------------------------------------------------------------------\nax = peace_ws.plot(edgecolor=\"black\", facecolor=\"none\", figsize=(4, 6))\npeace_river_clip.plot(ax=ax, color=\"deepskyblue\", linewidth=1)\n\nplt.title(\"Peace River Flowline (Clipped to Watershed)\")\nplt.show()","key":"XzhCqT2tV0"},{"type":"outputs","id":"srBNFmNDGBxaIE9nSRFUu","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Peace WS CRS: EPSG:4326\nRaw flowline features: 274\nClipped flowline features: 195\n"},"children":[],"key":"IH9c22jVOL"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7c05951b1fab4b46abe4a886db0bd309","path":"/red-tide-book//build/7c05951b1fab4b46abe4a886db0bd309.png"},"text/plain":{"content":"<Figure size 400x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"uojhvvOtHN"}],"key":"G3meZPpEaU"}],"key":"lkZ1JEct0f"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"6. Monitoring Stations, Coordinate Transformation, and Map Generation (Peace River)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ii6k6v5fMg"}],"identifier":"id-6-monitoring-stations-coordinate-transformation-and-map-generation-peace-river","label":"6. Monitoring Stations, Coordinate Transformation, and Map Generation (Peace River)","html_id":"id-6-monitoring-stations-coordinate-transformation-and-map-generation-peace-river","implicit":true,"key":"tHLbNixZIE"}],"key":"YXPRKfJarw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import geopandas as gpd\nimport matplotlib.pyplot as plt\nfrom shapely.geometry import Point\nimport contextily as cx\nimport matplotlib.lines as mlines\n\n# -----------------------------------------------------------\n# 1. PEACE RIVER STATION LOCATIONS (EDIT COORDS AS NEEDED)\n# -----------------------------------------------------------\nstations_peace_data = [\n    {\"name\": \"NEAR GARDNER\",          \"lon\": -81.8320229, \"lat\": 27.3669874},\n    {\"name\": \"ARCADIA\",               \"lon\": -81.8761946, \"lat\": 27.22088245},\n    {\"name\": \"NOCATEE\",               \"lon\": -81.90175090, \"lat\": 27.16282928},\n    {\"name\": \"PEACE RIVER RESERVOIR\", \"lon\": -82.056225, \"lat\": 27.056806},\n]\n\nstations_peace = gpd.GeoDataFrame(\n    stations_peace_data,\n    geometry=[Point(d[\"lon\"], d[\"lat\"]) for d in stations_peace_data],\n    crs=\"EPSG:4326\"\n)\n\n# -----------------------------------------------------------\n# 2. REPROJECT EVERYTHING TO WEB MERCATOR FOR BASEMAP\n# -----------------------------------------------------------\ntarget_crs = \"EPSG:3857\"\n\npeace_ws_3857       = peace_ws.to_crs(target_crs)\npeace_river_3857    = peace_river_clip.to_crs(target_crs)\nstations_peace_3857 = stations_peace.to_crs(target_crs)\n\n# -----------------------------------------------------------\n# 3. CREATE FIGURE (TALL LIKE YOUR ADVISOR'S)\n# -----------------------------------------------------------\nfig, ax = plt.subplots(figsize=(4, 8), dpi=300)\n\n# Watershed outline\npeace_ws_3857.boundary.plot(ax=ax, color=\"black\", linewidth=1)\n\n# River line\npeace_river_3857.plot(ax=ax, color=\"deepskyblue\", linewidth=2)\n\n# Stations\nstations_peace_3857.plot(ax=ax, color=\"blue\", markersize=25)\n\n# -----------------------------------------------------------\n# 4. LABELS WITH PER-STATION OFFSETS\n# -----------------------------------------------------------\noffsets_peace = {\n    \"NEAR GARDNER\":          ( 1500,  800),\n    \"ARCADIA\":               ( 1500,    0),\n    \"NOCATEE\":               ( 1500, -600),\n    \"PEACE RIVER RESERVOIR\": ( 1500, -800),\n}\n\nfor x, y, label in zip(\n        stations_peace_3857.geometry.x,\n        stations_peace_3857.geometry.y,\n        stations_peace_3857[\"name\"]):\n\n    dx, dy = offsets_peace.get(label, (500, 500))\n    ax.text(x + dx, y + dy, label, fontsize=6, color=\"navy\")\n\n# -----------------------------------------------------------\n# 5. EXTENT, BASEMAP, LEGEND\n# -----------------------------------------------------------\nxmin, ymin, xmax, ymax = peace_ws_3857.total_bounds\npad = 5000  # meters of padding\nax.set_xlim(xmin - pad, xmax + pad)\nax.set_ylim(ymin - pad, ymax + pad)\n\n# OSM basemap\ncx.add_basemap(\n    ax,\n    source=cx.providers.OpenStreetMap.Mapnik,\n    crs=target_crs,\n    alpha=0.8\n)\n\n# Legend entries\nstation_handle = mlines.Line2D([], [], color=\"blue\", marker=\"o\",\n                               linestyle=\"None\", markersize=5,\n                               label=\"Stations\")\nriver_handle = mlines.Line2D([], [], color=\"deepskyblue\",\n                             linewidth=2, label=\"Peace River\")\n\nax.legend(handles=[station_handle, river_handle],\n          loc=\"upper right\", fontsize=7, frameon=True)\n\nax.set_xticks([])\nax.set_yticks([])\n\nplt.tight_layout()\n\n# -----------------------------------------------------------\n# 6. SAVE HIGH-RES IMAGE TO YOUR FOLDER\n# -----------------------------------------------------------\nplt.savefig(\n    r\"C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Peace River Watershed Graphics\\peace_river_watershed_map.png\",\n    dpi=600,\n    bbox_inches=\"tight\"\n)\n\nplt.show()","key":"Bqt3ziew6C"},{"type":"outputs","id":"rhBK4F0jPP4XDAh5MRuJp","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4387b7a9617046081af15767454c2123","path":"/red-tide-book//build/4387b7a9617046081af15767454c2123.png"},"text/plain":{"content":"<Figure size 1200x2400 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"PZaVCE2ZsI"}],"key":"bbIFvwOJHY"}],"key":"cSwgZk3ikx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"7. Generate Side by Side Graphic of Watersheds","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RX8PdffRKf"}],"identifier":"id-7-generate-side-by-side-graphic-of-watersheds","label":"7. Generate Side by Side Graphic of Watersheds","html_id":"id-7-generate-side-by-side-graphic-of-watersheds","implicit":true,"key":"oJX1ViOC1t"}],"key":"JPJ9ouLBLI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from PIL import Image\nimport matplotlib.pyplot as plt\n\n# --- EDIT THESE PATHS to your actual saved map files ---\npeace_png = r\"C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Peace River Watershed Graphics\\peace_river_watershed_map.png\"\ncaloosa_png = r\"C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Caloosahatchee watershed Graphics\\caloosahatchee_watershed_map.png\"\n\n# Output file\nout_png = r\"C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Figure_1_Study_Area_Peace_Caloosa.png\"\n\n# Load images\nimg_peace = Image.open(peace_png)\nimg_caloosa = Image.open(caloosa_png)\n\n# Make them the same height (keeps proportions clean)\ntarget_h = max(img_peace.height, img_caloosa.height)\n\nimg_peace = img_peace.resize(\n    (int(img_peace.width * target_h / img_peace.height), target_h)\n)\n\nimg_caloosa = img_caloosa.resize(\n    (int(img_caloosa.width * target_h / img_caloosa.height), target_h)\n)\n\n# Plot side-by-side\nfig, axes = plt.subplots(1, 2, figsize=(10, 7), dpi=300)\n\naxes[0].imshow(img_peace)\naxes[0].axis(\"off\")\naxes[0].text(\n    0.02, 0.98, \"(a)\",\n    transform=axes[0].transAxes,\n    ha=\"left\", va=\"top\",\n    fontsize=14,\n    bbox=dict(facecolor=\"white\", edgecolor=\"none\", alpha=0.75)\n)\n\naxes[1].imshow(img_caloosa)\naxes[1].axis(\"off\")\naxes[1].text(\n    0.02, 0.98, \"(b)\",\n    transform=axes[1].transAxes,\n    ha=\"left\", va=\"top\",\n    fontsize=14,\n    bbox=dict(facecolor=\"white\", edgecolor=\"none\", alpha=0.75)\n)\n\nplt.tight_layout()\n\n# Save combined figure\nplt.savefig(out_png, dpi=600, bbox_inches=\"tight\")\nplt.show()","key":"KnJYj5AEvA"},{"type":"outputs","id":"bTVKf6z4g5dY0BhMJX6O4","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e9329531ec1b75e37846eded759392c8","path":"/red-tide-book//build/e9329531ec1b75e37846eded759392c8.png"},"text/plain":{"content":"<Figure size 3000x2100 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"bA4Vn7Mm2d"}],"key":"lzMoiHqJmh"}],"key":"WiGEWR49Kj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from PIL import Image, ImageOps\nimport matplotlib.pyplot as plt\nimport matplotlib.gridspec as gridspec\n\n# -----------------------------------------------------------\n# INPUT FILE PATHS (EDIT IF NEEDED)\n# -----------------------------------------------------------\npeace_png = r\"C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Peace River Watershed Graphics\\peace_river_watershed_map.png\"\ncaloosa_png = r\"C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Caloosahatchee watershed Graphics\\caloosahatchee_watershed_map.png\"\n\n# OUTPUT FILE\nout_png = r\"C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Figure_1_Study_Area_Peace_Caloosa_PUBLICATION.png\"\n\n# -----------------------------------------------------------\n# LOAD IMAGES (CONVERT RGBA → RGB TO AVOID PIL ERROR)\n# -----------------------------------------------------------\nimgA = Image.open(peace_png).convert(\"RGB\")\nimgB = Image.open(caloosa_png).convert(\"RGB\")\n\n# OPTIONAL: autocontrast to tighten whites (safe now)\nimgA = ImageOps.autocontrast(imgA)\nimgB = ImageOps.autocontrast(imgB)\n\n# -----------------------------------------------------------\n# RESIZE TO MATCH WIDTHS (MAKES PANELS FEEL BALANCED)\n# -----------------------------------------------------------\ntarget_width = 1400  # adjust if desired\n\nimgA = imgA.resize(\n    (target_width, int(imgA.height * target_width / imgA.width))\n)\nimgB = imgB.resize(\n    (target_width, int(imgB.height * target_width / imgB.width))\n)\n\n# -----------------------------------------------------------\n# CREATE GRID LAYOUT (PUBLICATION STYLE)\n# -----------------------------------------------------------\nfig = plt.figure(figsize=(10, 7), dpi=300)\n\ngs = gridspec.GridSpec(\n    2, 2,\n    width_ratios=[1.0, 1.0],\n    height_ratios=[1.0, 1.0],\n    wspace=0.05,\n    hspace=0.05\n)\n\n# (a) Peace River — left column, full height\naxA = fig.add_subplot(gs[:, 0])\naxA.imshow(imgA)\naxA.axis(\"off\")\naxA.text(\n    0.02, 0.98, \"(a)\",\n    transform=axA.transAxes,\n    ha=\"left\", va=\"top\",\n    fontsize=14,\n    bbox=dict(facecolor=\"white\", edgecolor=\"none\", alpha=0.8)\n)\n\n# (b) Caloosahatchee — upper right\naxB = fig.add_subplot(gs[0, 1])\naxB.imshow(imgB)\naxB.axis(\"off\")\naxB.text(\n    0.02, 0.98, \"(b)\",\n    transform=axB.transAxes,\n    ha=\"left\", va=\"top\",\n    fontsize=14,\n    bbox=dict(facecolor=\"white\", edgecolor=\"none\", alpha=0.8)\n)\n\n# Bottom-right intentionally blank (clean composition)\nax_blank = fig.add_subplot(gs[1, 1])\nax_blank.axis(\"off\")\n\n# -----------------------------------------------------------\n# SAVE HIGH-RES FIGURE\n# -----------------------------------------------------------\nplt.savefig(out_png, dpi=600, bbox_inches=\"tight\")\nplt.show()\n\nprint(\"Saved publication figure to:\")\nprint(out_png)","key":"YGKErwKThn"},{"type":"outputs","id":"JrGMdfFbwfSV4fE3TWAVD","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"613cc96ccaa7c622e2c03e31701a49e8","path":"/red-tide-book//build/613cc96ccaa7c622e2c03e31701a49e8.png"},"text/plain":{"content":"<Figure size 3000x2100 with 3 Axes>","content_type":"text/plain"}}},"children":[],"key":"nIU3O5Ajgl"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Saved publication figure to:\nC:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Figure_1_Study_Area_Peace_Caloosa_PUBLICATION.png\n"},"children":[],"key":"C4yJOV2kwM"}],"key":"crE9gvKuoW"}],"key":"oVHOR8uYEo"}],"key":"kbxXSmxM7s"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Data Integration for Southwest Florida","url":"/data-swfl-combined","group":"Red Tide Data and Modeling Book"},"next":{"title":"Machine Learning Model for Combined Peace River and Caloosahatchee River","url":"/ml-model-swfl-with-tampa","group":"Red Tide Data and Modeling Book"}}},"domain":"http://localhost:3000"}