{"version":3,"kind":"Notebook","sha256":"01147fd6daec826086ebd784ea59ddb379939cc860e5376bca078d209ddcf570","slug":"data-swfl-combined","location":"/Data_SWFL_Combined.ipynb","dependencies":[],"frontmatter":{"title":"Data Integration for Southwest Florida","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"id":"Matthew Duus","name":"Matthew Duus"}],"exports":[{"format":"ipynb","filename":"Data_SWFL_Combined.ipynb","url":"/red-tide-book//build/Data_SWFL_Combined-4cc57a96cf5221853079af1807aeae6b.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1. Discharge Monitoring at S.R.-79 on the Caloosahatchee River","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"t3d9e2xLxh"}],"identifier":"id-1-discharge-monitoring-at-s-r-79-on-the-caloosahatchee-river","label":"1. Discharge Monitoring at S.R.-79 on the Caloosahatchee River","html_id":"id-1-discharge-monitoring-at-s-r-79-on-the-caloosahatchee-river","implicit":true,"key":"TjWQvn5Pbw"}],"key":"z2HueIpe1F"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1.1 Selecting Discharge Station on Caloosahatchee River","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DY2DsQTITR"}],"identifier":"id-1-1-selecting-discharge-station-on-caloosahatchee-river","label":"1.1 Selecting Discharge Station on Caloosahatchee River","html_id":"id-1-1-selecting-discharge-station-on-caloosahatchee-river","implicit":true,"key":"njQMWtMEHD"}],"key":"ftuqtezSGo"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The USGS site number 02292900 corresponds to the streamflow monitoring station at the Caloosahatchee River at S.R.-79 near Olga, Florida. This station, also known as the Franklin Lock and Dam (S-79), has been operational since 1966 and is a key point for monitoring freshwater flow into the Caloosahatchee Estuary.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"M2D6JRmqal"}],"key":"zSwmSkErNh"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This site is managed by the U.S. Geological Survey (USGS) and provides real-time and historical data on streamflow, which is crucial for water resource management, ecological studies, and flood forecasting.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JIgpXS4ya1"}],"key":"agYwxUDTLw"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"USGS site data: ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fBmpGIokKc"},{"type":"link","url":"https://waterdata.usgs.gov/nwis/inventory?site_no=02292900","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"https://​waterdata​.usgs​.gov​/nwis​/inventory​?site​_no​=​02292900","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ggNWcUR7G3"}],"urlSource":"https://waterdata.usgs.gov/nwis/inventory?site_no=02292900","key":"i26YNqLMI4"}],"key":"P0aE1Rvm3p"}],"key":"kjG2ahRaf9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport os\nimport pandas as pd\nimport requests\nimport zipfile\nfrom io import BytesIO\nimport shutil\n\ndf_dis = pd.read_csv('USGS Data Science Project.csv')\ndf_dis","key":"NMAZciKIUY"},{"type":"outputs","id":"cFVTR8SxijSFvAHaHc-_Q","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":1,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Source</th>\n      <th>Site Number</th>\n      <th>Date</th>\n      <th>Discharge</th>\n      <th>Qualification</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>1/1/1993</td>\n      <td>14.0</td>\n      <td>A</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>1/2/1993</td>\n      <td>160.0</td>\n      <td>A</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>1/3/1993</td>\n      <td>820.0</td>\n      <td>A</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>1/4/1993</td>\n      <td>11.0</td>\n      <td>A</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>1/5/1993</td>\n      <td>9.2</td>\n      <td>A</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>11778</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>4/1/2025</td>\n      <td>1870.0</td>\n      <td>P</td>\n    </tr>\n    <tr>\n      <th>11779</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>4/2/2025</td>\n      <td>1390.0</td>\n      <td>P</td>\n    </tr>\n    <tr>\n      <th>11780</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>4/3/2025</td>\n      <td>1050.0</td>\n      <td>P</td>\n    </tr>\n    <tr>\n      <th>11781</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>4/4/2025</td>\n      <td>849.0</td>\n      <td>P</td>\n    </tr>\n    <tr>\n      <th>11782</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>4/5/2025</td>\n      <td>1050.0</td>\n      <td>P</td>\n    </tr>\n  </tbody>\n</table>\n<p>11783 rows × 5 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"      Source  Site Number      Date  Discharge Qualification\n0       USGS      2292900  1/1/1993       14.0             A\n1       USGS      2292900  1/2/1993      160.0             A\n2       USGS      2292900  1/3/1993      820.0             A\n3       USGS      2292900  1/4/1993       11.0             A\n4       USGS      2292900  1/5/1993        9.2             A\n...      ...          ...       ...        ...           ...\n11778   USGS      2292900  4/1/2025     1870.0             P\n11779   USGS      2292900  4/2/2025     1390.0             P\n11780   USGS      2292900  4/3/2025     1050.0             P\n11781   USGS      2292900  4/4/2025      849.0             P\n11782   USGS      2292900  4/5/2025     1050.0             P\n\n[11783 rows x 5 columns]","content_type":"text/plain"}}},"children":[],"key":"b7mlGp8iGF"}],"key":"kI99d0vACV"}],"key":"aneQ9cuRMn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_dis.Date = pd.to_datetime(df_dis.Date)\ndf_dis.Date.dtypes","key":"PDZMPaOlfL"},{"type":"outputs","id":"aYbfzU2WPtniH42Z7dCSy","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"dtype('<M8[ns]')","content_type":"text/plain"}}},"children":[],"key":"DKC6SNnf8X"}],"key":"PQ8XPByunb"}],"key":"LUHqiMZvnW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"columns = ['Source', 'Site Number', 'Date', 'Discharge']\ndf_dis = df_dis[columns]\ndf_dis","key":"BKE04D3nxh"},{"type":"outputs","id":"dFfPzek2d1M8E12l1Ukaq","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Source</th>\n      <th>Site Number</th>\n      <th>Date</th>\n      <th>Discharge</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>1993-01-01</td>\n      <td>14.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>1993-01-02</td>\n      <td>160.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>1993-01-03</td>\n      <td>820.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>1993-01-04</td>\n      <td>11.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>1993-01-05</td>\n      <td>9.2</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>11778</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>2025-04-01</td>\n      <td>1870.0</td>\n    </tr>\n    <tr>\n      <th>11779</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>2025-04-02</td>\n      <td>1390.0</td>\n    </tr>\n    <tr>\n      <th>11780</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>2025-04-03</td>\n      <td>1050.0</td>\n    </tr>\n    <tr>\n      <th>11781</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>2025-04-04</td>\n      <td>849.0</td>\n    </tr>\n    <tr>\n      <th>11782</th>\n      <td>USGS</td>\n      <td>2292900</td>\n      <td>2025-04-05</td>\n      <td>1050.0</td>\n    </tr>\n  </tbody>\n</table>\n<p>11783 rows × 4 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"      Source  Site Number       Date  Discharge\n0       USGS      2292900 1993-01-01       14.0\n1       USGS      2292900 1993-01-02      160.0\n2       USGS      2292900 1993-01-03      820.0\n3       USGS      2292900 1993-01-04       11.0\n4       USGS      2292900 1993-01-05        9.2\n...      ...          ...        ...        ...\n11778   USGS      2292900 2025-04-01     1870.0\n11779   USGS      2292900 2025-04-02     1390.0\n11780   USGS      2292900 2025-04-03     1050.0\n11781   USGS      2292900 2025-04-04      849.0\n11782   USGS      2292900 2025-04-05     1050.0\n\n[11783 rows x 4 columns]","content_type":"text/plain"}}},"children":[],"key":"GvCcOwfRmB"}],"key":"AyaYnM9cDf"}],"key":"Ixzy7aM0ee"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Data cleaned\ndf_dis_clean = df_dis.dropna()\n\nparameters = ['Discharge']\nunits = ['cfs']\n\nmetadata = {\n    'Discharge': {'Unit': 'cfs'}\n}\n\nsummary_data = []\n\nfor column in df_dis.columns:\n    if column not in metadata:\n        continue\n\n    col_data = df_dis[column].dropna()\n    stats = {\n        'Parameter': column,\n        'Unit': metadata[column]['Unit'],\n        'Min': round(col_data.min(), 2),\n        'Mean': round(col_data.mean(), 2),\n        'Median': round(col_data.median(), 2),\n        'Max': round(col_data.max(), 2)\n    }\n    summary_data.append(stats)\n\ndf_dis_summary = pd.DataFrame(summary_data)\ndisplay(df_dis_summary)","key":"eJ2uzLgzfs"},{"type":"outputs","id":"u1v1NPSQrbwfrxPjlMHL0","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Parameter</th>\n      <th>Unit</th>\n      <th>Min</th>\n      <th>Mean</th>\n      <th>Median</th>\n      <th>Max</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Discharge</td>\n      <td>cfs</td>\n      <td>0.0</td>\n      <td>2104.5</td>\n      <td>1220.0</td>\n      <td>25300.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"   Parameter Unit  Min    Mean  Median      Max\n0  Discharge  cfs  0.0  2104.5  1220.0  25300.0","content_type":"text/plain"}}},"children":[],"key":"qxr5Nl9QqS"}],"key":"rX0pGnI99W"}],"key":"iYtC1Sq1Nt"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1.2 Caloosahatchee River Discharge","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KETtg7LHZd"}],"identifier":"id-1-2-caloosahatchee-river-discharge","label":"1.2 Caloosahatchee River Discharge","html_id":"id-1-2-caloosahatchee-river-discharge","implicit":true,"key":"xXrIVhr58C"}],"key":"wgtOBNurQ1"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section processes discharge data from the Caloosahatchee River at the S-79 structure, obtained from the USGS. The data is filtered to retain daily mean discharge values, and timestamps are converted to datetime format for alignment with other environmental datasets. The section ensures the discharge values are numeric and drops any rows with missing data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XX92Qpdakw"}],"key":"c9lOVauBcR"}],"key":"fSN7BWuMCe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport matplotlib.dates as mdates\n\n# Line plot of discharge\ndf_dis[['Discharge']].plot(\n    color=['blue'],\n    linewidth=1,\n    xlabel='Date',\n    ylabel='Discharge_Dis [cfs]',\n    figsize=(16, 7),\n    title='Caloosahatchee River Discharge',\n    grid=False,\n    legend=True,\n    style=['-'],\n    alpha=0.8,\n    rot=0,\n    fontsize=12,\n);","key":"WjfJM7tjvk"},{"type":"outputs","id":"m9CxX4nbtVwCzLiVvwOLv","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0ba468079c62eb95a24398120a09c217","path":"/red-tide-book//build/0ba468079c62eb95a24398120a09c217.png"},"text/plain":{"content":"<Figure size 1600x700 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"UsN2qzjTfF"}],"key":"uOBmc1crlH"}],"key":"rKD4I81BkF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"max_discharge_dis = df_dis['Discharge'].max()\nprint(max_discharge_dis)","key":"lGr32TCHEH"},{"type":"outputs","id":"LcmxtvNjb1WDUIcqJt91q","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"25300.0\n"},"children":[],"key":"AEf3TWitma"}],"key":"CQjJQb3yO4"}],"key":"VjRhn0Mze3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"avg_discharge_dis = df_dis['Discharge'].mean()\nprint(avg_discharge_dis)","key":"ETkWAKQKCi"},{"type":"outputs","id":"Fj4gptC4hNEYlhzR70pay","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"2104.5010027425437\n"},"children":[],"key":"JIVufz9z3F"}],"key":"AUqRDs8888"}],"key":"zq7LLx6bue"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1.3 Creating a Continuous Discharge Record","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kZa5e2qcG5"}],"identifier":"id-1-3-creating-a-continuous-discharge-record","label":"1.3 Creating a Continuous Discharge Record","html_id":"id-1-3-creating-a-continuous-discharge-record","implicit":true,"key":"L760ylSh4Y"}],"key":"g1dR0pR2e8"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section addresses gaps in the Caloosahatchee River discharge dataset by applying interpolation and filling techniques. Missing discharge values are first replaced with NaNs, then interpolated linearly to estimate intermediate values. Any remaining missing values at the start or end of the series are filled using forward and backward fill methods. The cleaned and gap-filled dataset is then visualized in a time series plot spanning from 1993 to 2025, showing the long-term variability in daily discharge rates. This step ensures a continuous discharge record for use in later modeling and analysis.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YJTIjBBjIf"}],"key":"RNgKQXL38s"}],"key":"kwEPL2tdXb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Replace 0s with NaN in 'Discharge' column\ndf_dis.loc[:, 'Discharge'] = df_dis['Discharge'].replace(0, pd.NA)\n\n# Interpolate missing values linearly\ndf_dis.loc[:, 'Discharge'] = df_dis['Discharge'].interpolate(method='linear')\n\n# Fill remaining NaNs at the start/end using forward/backward fill\ndf_dis.loc[:, 'Discharge'] = df_dis['Discharge'].ffill().bfill()","key":"XDO6Gig9cC"},{"type":"outputs","id":"tHkmfnKTfrgdgJ1k-7CJ3","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"C:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\2941276119.py:2: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise in a future error of pandas. Value '[14.0 160.0 820.0 ... 1050.0 849.0 1050.0]' has dtype incompatible with float64, please explicitly cast to a compatible dtype first.\n  df_dis.loc[:, 'Discharge'] = df_dis['Discharge'].replace(0, pd.NA)\nC:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\2941276119.py:5: FutureWarning: Series.interpolate with object dtype is deprecated and will raise in a future version. Call obj.infer_objects(copy=False) before interpolating instead.\n  df_dis.loc[:, 'Discharge'] = df_dis['Discharge'].interpolate(method='linear')\nC:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\2941276119.py:8: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`\n  df_dis.loc[:, 'Discharge'] = df_dis['Discharge'].ffill().bfill()\n"},"children":[],"key":"uwfpubx52R"}],"key":"jWWK1GoaXy"}],"key":"PDMjVZ3ldl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport matplotlib.dates as mdates\n\n# Ensure 'Date' is datetime\ndf_dis['Date'] = pd.to_datetime(df_dis['Date'])\n\n# Create plot\nplt.figure(num=18, figsize=(16, 7))\nplt.plot(df_dis['Date'], df_dis['Discharge'], color='blue', linewidth=1, linestyle='-', alpha=0.8, label='Discharge')\n\n# Format x-axis\nplt.gca().xaxis.set_major_locator(mdates.YearLocator())\nplt.gca().xaxis.set_major_formatter(mdates.DateFormatter('%Y'))\nplt.xlim(df_dis['Date'].min(), df_dis['Date'].max())\n\n# Add horizontal line at 0\nplt.axhline(y=0, color='black', linestyle='--', linewidth=1)\n\n# Labels and formatting\nplt.xlabel('Date', fontsize=12)\nplt.ylabel('Discharge [cfs]', fontsize=12)\nplt.title('Caloosahatchee River Discharge', fontsize=20)\nplt.legend()\nplt.grid(True)\nplt.xticks(rotation=0)\nplt.tight_layout()\nplt.show()","key":"AxMRSIaQ5K"},{"type":"outputs","id":"gpUjEImWCMB5UxRMXKQcA","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"C:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\3119331194.py:5: SettingWithCopyWarning: \nA value is trying to be set on a copy of a slice from a DataFrame.\nTry using .loc[row_indexer,col_indexer] = value instead\n\nSee the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n  df_dis['Date'] = pd.to_datetime(df_dis['Date'])\n"},"children":[],"key":"g63bbYizNl"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"595400aaedc6c60c02b6065e67fed51b","path":"/red-tide-book//build/595400aaedc6c60c02b6065e67fed51b.png"},"text/plain":{"content":"<Figure size 1600x700 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"GJTkycdDhz"}],"key":"gVlFYoGpCy"}],"key":"FUu6lGNOnV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1.4 Discharge With Hurricane Season Noted","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kHlUIvtkAs"}],"identifier":"id-1-4-discharge-with-hurricane-season-noted","label":"1.4 Discharge With Hurricane Season Noted","html_id":"id-1-4-discharge-with-hurricane-season-noted","implicit":true,"key":"t2vOkRklyw"}],"key":"hyDy34laMr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section enhances the Caloosahatchee River discharge time series by visually marking the Atlantic hurricane season (June 1 to November 30) for each year in the dataset. Using a loop, shaded bands are dynamically added to the plot for every hurricane season between 1993 and 2025. This contextual overlay allows for a clearer visual association between periods of heightened tropical activity and observed discharge spikes. By highlighting these seasonal windows, the plot provides insight into how discharge patterns may be influenced by rainfall and runoff associated with hurricanes and tropical storms, which are relevant for nutrient loading and potential HAB triggers.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"S0SJxoDxYy"}],"key":"WYs2phMC7O"}],"key":"iW4rdMvDzb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from datetime import datetime\n\nplt.figure(num=19, figsize=(16, 7))\nplt.plot(df_dis['Date'], df_dis['Discharge'], color='blue', linewidth=1, linestyle='-', alpha=0.8, label='Discharge')\n\nplt.gca().xaxis.set_major_locator(mdates.YearLocator())\nplt.gca().xaxis.set_major_formatter(mdates.DateFormatter('%Y'))\nplt.xlim(df_dis['Date'].min(), df_dis['Date'].max())\n\n# Highlight hurricane season\nyears = df_dis['Date'].dt.year.unique()\nfor year in years:\n    start = pd.Timestamp(f\"{year}-06-01\")\n    end = pd.Timestamp(f\"{year}-11-30\")\n    plt.axvspan(start, end, color='orange', alpha=0.125, label='Hurricane Season' if year == years[0] else \"\")\n\nplt.xlabel('Date', fontsize=12)\nplt.ylabel('Discharge [cfs]', fontsize=12)\nplt.title('Caloosahatchee River Discharge with Hurricane Season Indicated', fontsize=16)\nplt.grid(True)\nplt.legend()\nplt.tight_layout()\nplt.show()","key":"a7p8GWgPsz"},{"type":"outputs","id":"hPZysKbP0ZqLWWs4-wQ_-","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c9288cf8ee2fd9d534489be8335b6e23","path":"/red-tide-book//build/c9288cf8ee2fd9d534489be8335b6e23.png"},"text/plain":{"content":"<Figure size 1600x700 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"mT9HLyTq9p"}],"key":"rlNBbeJJFz"}],"key":"G58kg0zrrm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(num=20, figsize=(16, 7))\nplt.plot(df_dis['Date'], df_dis['Discharge'], color='blue', linewidth=1, linestyle='-', alpha=0.8, label='Discharge')\n\nplt.gca().xaxis.set_major_locator(mdates.YearLocator())\nplt.gca().xaxis.set_major_formatter(mdates.DateFormatter('%Y'))\nplt.xlim(df_dis['Date'].min(), df_dis['Date'].max())\n\n# Shade hurricane season for each year\nfor year in df_dis['Date'].dt.year.unique():\n    start = pd.Timestamp(f\"{year}-06-01\")\n    end = pd.Timestamp(f\"{year}-11-30\")\n    plt.axvspan(start, end, color='orange', alpha=0.1, label='Hurricane Season' if year == df_dis['Date'].dt.year.unique()[0] else \"\")\n\nplt.xlabel('Date', fontsize=12)\nplt.ylabel('Discharge [cfs]', fontsize=12)\nplt.title('Caloosahatchee River Discharge with Hurricane Season Indicated', fontsize=12)\nplt.grid(True)\nplt.legend()\nplt.tight_layout()\nplt.show()","key":"AKRQrVHyhI"},{"type":"outputs","id":"6-XXOCRd7d1UjILa5H1iP","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4f7c7bccde3ef382c5e699a5ff85c4a2","path":"/red-tide-book//build/4f7c7bccde3ef382c5e699a5ff85c4a2.png"},"text/plain":{"content":"<Figure size 1600x700 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"tKrPfuCk7f"}],"key":"VbkBKTxNf5"}],"key":"USbfGcNhmN"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2. Nutrient Data for the Caloosahatchee River: TN and TP Monitoring","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ao42keoZiK"}],"identifier":"id-2-nutrient-data-for-the-caloosahatchee-river-tn-and-tp-monitoring","label":"2. Nutrient Data for the Caloosahatchee River: TN and TP Monitoring","html_id":"id-2-nutrient-data-for-the-caloosahatchee-river-tn-and-tp-monitoring","implicit":true,"key":"fw81Wf1JCK"}],"key":"Cvz4hUKV9S"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The Total Nitrogen (TN) and Total Phosphorus (TP) data for both the upper and lower Caloosahatchee River were obtained from Florida’s STORET repository, a state-managed version of the EPA’s national water quality database. These records include monitoring results from agencies like the Florida Department of Environmental Protection and Lee County’s Environmental Laboratory.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"phkhRpZq1k"}],"key":"HWA2ritkup"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The dataset provides time-stamped, geolocated measurements of nutrient concentrations, which are essential for assessing eutrophication risk and forecasting red tide conditions driven by land-based nutrient runoff.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MpwB9swGTC"}],"key":"M8zDNJfPOA"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Water Atlas data site: ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mf3UaDvql8"},{"type":"link","url":"https://chnep.wateratlas.usf.edu/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"https://​chnep​.wateratlas​.usf​.edu/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eDExXq0Jl6"}],"urlSource":"https://chnep.wateratlas.usf.edu/","key":"PMQ2LSp4X5"}],"key":"RmC03m4Jra"}],"key":"ELE5AEGDIP"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.1 Nutrient Data: Upper Caloosahatchee (Olga, FL)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PnQxUJUU7y"}],"identifier":"id-2-1-nutrient-data-upper-caloosahatchee-olga-fl","label":"2.1 Nutrient Data: Upper Caloosahatchee (Olga, FL)","html_id":"id-2-1-nutrient-data-upper-caloosahatchee-olga-fl","implicit":true,"key":"SeKhCUntLY"}],"key":"fYLede4N7i"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section loads nutrient monitoring data from the upper Caloosahatchee River at the S.R. 79 (Olga) station and prepares it for analysis. The dataset is filtered to extract relevant nutrient parameters and converted to datetime format for alignment with other variables.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hHHZu7altR"}],"key":"teTVjVr5ca"}],"key":"zZcjuzy20H"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\n\n# Load the Caloosahatchee nutrient data\nnutrient_data = pd.read_csv(\"TN_TP_Caloosa.csv\")\n\n# Preview the dataset\nnutrient_data.head()","key":"dRjK8f1kQT"},{"type":"outputs","id":"FSY7oDBEXyLpwUDclMDj7","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>WBodyID</th>\n      <th>WaterBodyName</th>\n      <th>DataSource</th>\n      <th>StationID</th>\n      <th>StationName</th>\n      <th>Actual_StationID</th>\n      <th>Actual_Latitude</th>\n      <th>Actual_Longitude</th>\n      <th>DEP_WBID</th>\n      <th>SampleDate</th>\n      <th>...</th>\n      <th>DepthUnits</th>\n      <th>Parameter</th>\n      <th>Characteristic</th>\n      <th>Sample_Fraction</th>\n      <th>Result_Value</th>\n      <th>Result_Unit</th>\n      <th>QACode</th>\n      <th>Result_Comment</th>\n      <th>Original_Result_Value</th>\n      <th>Original_Result_Unit</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>STORET_21FLGW</td>\n      <td>3568</td>\n      <td>CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA</td>\n      <td>3568</td>\n      <td>26.7212</td>\n      <td>-81.693248</td>\n      <td>3235A</td>\n      <td>4/29/1999 0:00</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.096</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.096</td>\n      <td>mg/l</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>STORET_21FLGW</td>\n      <td>3568</td>\n      <td>CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA</td>\n      <td>3568</td>\n      <td>26.7212</td>\n      <td>-81.693248</td>\n      <td>3235A</td>\n      <td>4/29/1999 0:00</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.099</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.099</td>\n      <td>mg/l</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>STORET_21FLGW</td>\n      <td>3568</td>\n      <td>CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA</td>\n      <td>3568</td>\n      <td>26.7212</td>\n      <td>-81.693248</td>\n      <td>3235A</td>\n      <td>4/29/1999 0:00</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TN_mgl</td>\n      <td>Nitrogen</td>\n      <td>NaN</td>\n      <td>1.498</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>Water Institute Calculated</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>STORET_21FLGW</td>\n      <td>3568</td>\n      <td>CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA</td>\n      <td>3568</td>\n      <td>26.7212</td>\n      <td>-81.693248</td>\n      <td>3235A</td>\n      <td>5/24/1999 0:00</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.170</td>\n      <td>mg/l</td>\n      <td>JQ</td>\n      <td>**JQ** The precision was outside the QC limit....</td>\n      <td>0.170</td>\n      <td>mg/l</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>STORET_21FLGW</td>\n      <td>3568</td>\n      <td>CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA</td>\n      <td>3568</td>\n      <td>26.7212</td>\n      <td>-81.693248</td>\n      <td>3235A</td>\n      <td>5/24/1999 0:00</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TN_mgl</td>\n      <td>Nitrogen</td>\n      <td>NaN</td>\n      <td>1.600</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>Water Institute Calculated</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows × 21 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"   WBodyID         WaterBodyName     DataSource  StationID  \\\n0   300081  Caloosahatchee River  STORET_21FLGW       3568   \n1   300081  Caloosahatchee River  STORET_21FLGW       3568   \n2   300081  Caloosahatchee River  STORET_21FLGW       3568   \n3   300081  Caloosahatchee River  STORET_21FLGW       3568   \n4   300081  Caloosahatchee River  STORET_21FLGW       3568   \n\n                                  StationName  Actual_StationID  \\\n0   CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA              3568   \n1   CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA              3568   \n2   CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA              3568   \n3   CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA              3568   \n4   CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA              3568   \n\n   Actual_Latitude  Actual_Longitude DEP_WBID      SampleDate  ...  \\\n0          26.7212        -81.693248    3235A  4/29/1999 0:00  ...   \n1          26.7212        -81.693248    3235A  4/29/1999 0:00  ...   \n2          26.7212        -81.693248    3235A  4/29/1999 0:00  ...   \n3          26.7212        -81.693248    3235A  5/24/1999 0:00  ...   \n4          26.7212        -81.693248    3235A  5/24/1999 0:00  ...   \n\n   DepthUnits Parameter   Characteristic Sample_Fraction Result_Value  \\\n0           m    TP_mgl  Phosphorus as P           Total        0.096   \n1           m    TP_mgl  Phosphorus as P           Total        0.099   \n2           m    TN_mgl         Nitrogen             NaN        1.498   \n3           m    TP_mgl  Phosphorus as P           Total        0.170   \n4           m    TN_mgl         Nitrogen             NaN        1.600   \n\n   Result_Unit QACode                                     Result_Comment  \\\n0         mg/l    NaN                                                NaN   \n1         mg/l    NaN                                                NaN   \n2         mg/l    NaN                         Water Institute Calculated   \n3         mg/l     JQ  **JQ** The precision was outside the QC limit....   \n4         mg/l    NaN                         Water Institute Calculated   \n\n  Original_Result_Value  Original_Result_Unit  \n0                 0.096                  mg/l  \n1                 0.099                  mg/l  \n2                   NaN                   NaN  \n3                 0.170                  mg/l  \n4                   NaN                   NaN  \n\n[5 rows x 21 columns]","content_type":"text/plain"}}},"children":[],"key":"t4WuRXCV19"}],"key":"cT0hdBdb0d"}],"key":"EhP6RqWmRs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Convert sample date to datetime\nnutrient_data['SampleDate'] = pd.to_datetime(nutrient_data['SampleDate'], errors='coerce')\n\n# Filter by nutrient type for Upper Caloosahatchee\ntp_data_upper = nutrient_data[nutrient_data['Parameter'] == 'TP_mg/l']\ntn_data_upper = nutrient_data[nutrient_data['Parameter'] == 'TN_mg/l']\n\nnutrient_data","key":"feRMy1krOw"},{"type":"outputs","id":"vR9V-G4f5wDoKvguiVltG","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>WBodyID</th>\n      <th>WaterBodyName</th>\n      <th>DataSource</th>\n      <th>StationID</th>\n      <th>StationName</th>\n      <th>Actual_StationID</th>\n      <th>Actual_Latitude</th>\n      <th>Actual_Longitude</th>\n      <th>DEP_WBID</th>\n      <th>SampleDate</th>\n      <th>...</th>\n      <th>DepthUnits</th>\n      <th>Parameter</th>\n      <th>Characteristic</th>\n      <th>Sample_Fraction</th>\n      <th>Result_Value</th>\n      <th>Result_Unit</th>\n      <th>QACode</th>\n      <th>Result_Comment</th>\n      <th>Original_Result_Value</th>\n      <th>Original_Result_Unit</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>STORET_21FLGW</td>\n      <td>3568</td>\n      <td>CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA</td>\n      <td>3568</td>\n      <td>26.721200</td>\n      <td>-81.693248</td>\n      <td>3235A</td>\n      <td>1999-04-29</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.096</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.096</td>\n      <td>mg/l</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>STORET_21FLGW</td>\n      <td>3568</td>\n      <td>CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA</td>\n      <td>3568</td>\n      <td>26.721200</td>\n      <td>-81.693248</td>\n      <td>3235A</td>\n      <td>1999-04-29</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.099</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.099</td>\n      <td>mg/l</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>STORET_21FLGW</td>\n      <td>3568</td>\n      <td>CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA</td>\n      <td>3568</td>\n      <td>26.721200</td>\n      <td>-81.693248</td>\n      <td>3235A</td>\n      <td>1999-04-29</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TN_mgl</td>\n      <td>Nitrogen</td>\n      <td>NaN</td>\n      <td>1.498</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>Water Institute Calculated</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>STORET_21FLGW</td>\n      <td>3568</td>\n      <td>CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA</td>\n      <td>3568</td>\n      <td>26.721200</td>\n      <td>-81.693248</td>\n      <td>3235A</td>\n      <td>1999-05-24</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.170</td>\n      <td>mg/l</td>\n      <td>JQ</td>\n      <td>**JQ** The precision was outside the QC limit....</td>\n      <td>0.170</td>\n      <td>mg/l</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>STORET_21FLGW</td>\n      <td>3568</td>\n      <td>CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA</td>\n      <td>3568</td>\n      <td>26.721200</td>\n      <td>-81.693248</td>\n      <td>3235A</td>\n      <td>1999-05-24</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TN_mgl</td>\n      <td>Nitrogen</td>\n      <td>NaN</td>\n      <td>1.600</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>Water Institute Calculated</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>1743</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>WIN_21FLSFWM</td>\n      <td>18245</td>\n      <td>S79</td>\n      <td>18245</td>\n      <td>26.722735</td>\n      <td>-81.691019</td>\n      <td>3235A</td>\n      <td>2025-01-06</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.111</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.111</td>\n      <td>mg/L</td>\n    </tr>\n    <tr>\n      <th>1744</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>WIN_21FLSFWM</td>\n      <td>18245</td>\n      <td>S79</td>\n      <td>18245</td>\n      <td>26.722735</td>\n      <td>-81.691019</td>\n      <td>3235A</td>\n      <td>2025-01-06</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TN_mgl</td>\n      <td>Nitrogen</td>\n      <td>Dissolved</td>\n      <td>1.100</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1.100</td>\n      <td>mg/L</td>\n    </tr>\n    <tr>\n      <th>1745</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>WIN_21FLSFWM</td>\n      <td>18245</td>\n      <td>S79</td>\n      <td>18245</td>\n      <td>26.722735</td>\n      <td>-81.691019</td>\n      <td>3235A</td>\n      <td>2025-01-06</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TN_mgl</td>\n      <td>Nitrogen</td>\n      <td>Total</td>\n      <td>1.260</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1.260</td>\n      <td>mg/L</td>\n    </tr>\n    <tr>\n      <th>1746</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>WIN_21FLSFWM</td>\n      <td>18245</td>\n      <td>S79</td>\n      <td>18245</td>\n      <td>26.722735</td>\n      <td>-81.691019</td>\n      <td>3235A</td>\n      <td>2025-01-13</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.096</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.096</td>\n      <td>mg/L</td>\n    </tr>\n    <tr>\n      <th>1747</th>\n      <td>300081</td>\n      <td>Caloosahatchee River</td>\n      <td>WIN_21FLSFWM</td>\n      <td>18245</td>\n      <td>S79</td>\n      <td>18245</td>\n      <td>26.722735</td>\n      <td>-81.691019</td>\n      <td>3235A</td>\n      <td>2025-01-13</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TN_mgl</td>\n      <td>Nitrogen</td>\n      <td>Total</td>\n      <td>1.290</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>1.290</td>\n      <td>mg/L</td>\n    </tr>\n  </tbody>\n</table>\n<p>1748 rows × 21 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"      WBodyID         WaterBodyName     DataSource  StationID  \\\n0      300081  Caloosahatchee River  STORET_21FLGW       3568   \n1      300081  Caloosahatchee River  STORET_21FLGW       3568   \n2      300081  Caloosahatchee River  STORET_21FLGW       3568   \n3      300081  Caloosahatchee River  STORET_21FLGW       3568   \n4      300081  Caloosahatchee River  STORET_21FLGW       3568   \n...       ...                   ...            ...        ...   \n1743   300081  Caloosahatchee River   WIN_21FLSFWM      18245   \n1744   300081  Caloosahatchee River   WIN_21FLSFWM      18245   \n1745   300081  Caloosahatchee River   WIN_21FLSFWM      18245   \n1746   300081  Caloosahatchee River   WIN_21FLSFWM      18245   \n1747   300081  Caloosahatchee River   WIN_21FLSFWM      18245   \n\n                                     StationName  Actual_StationID  \\\n0      CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA              3568   \n1      CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA              3568   \n2      CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA              3568   \n3      CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA              3568   \n4      CALOOSAHATCHEE RIVER AT S.R. 79 NEAR OLGA              3568   \n...                                          ...               ...   \n1743                                         S79             18245   \n1744                                         S79             18245   \n1745                                         S79             18245   \n1746                                         S79             18245   \n1747                                         S79             18245   \n\n      Actual_Latitude  Actual_Longitude DEP_WBID SampleDate  ...  DepthUnits  \\\n0           26.721200        -81.693248    3235A 1999-04-29  ...           m   \n1           26.721200        -81.693248    3235A 1999-04-29  ...           m   \n2           26.721200        -81.693248    3235A 1999-04-29  ...           m   \n3           26.721200        -81.693248    3235A 1999-05-24  ...           m   \n4           26.721200        -81.693248    3235A 1999-05-24  ...           m   \n...               ...               ...      ...        ...  ...         ...   \n1743        26.722735        -81.691019    3235A 2025-01-06  ...           m   \n1744        26.722735        -81.691019    3235A 2025-01-06  ...           m   \n1745        26.722735        -81.691019    3235A 2025-01-06  ...           m   \n1746        26.722735        -81.691019    3235A 2025-01-13  ...           m   \n1747        26.722735        -81.691019    3235A 2025-01-13  ...           m   \n\n     Parameter   Characteristic Sample_Fraction Result_Value  Result_Unit  \\\n0       TP_mgl  Phosphorus as P           Total        0.096         mg/l   \n1       TP_mgl  Phosphorus as P           Total        0.099         mg/l   \n2       TN_mgl         Nitrogen             NaN        1.498         mg/l   \n3       TP_mgl  Phosphorus as P           Total        0.170         mg/l   \n4       TN_mgl         Nitrogen             NaN        1.600         mg/l   \n...        ...              ...             ...          ...          ...   \n1743    TP_mgl  Phosphorus as P           Total        0.111         mg/l   \n1744    TN_mgl         Nitrogen       Dissolved        1.100         mg/l   \n1745    TN_mgl         Nitrogen           Total        1.260         mg/l   \n1746    TP_mgl  Phosphorus as P           Total        0.096         mg/l   \n1747    TN_mgl         Nitrogen           Total        1.290         mg/l   \n\n     QACode                                     Result_Comment  \\\n0       NaN                                                NaN   \n1       NaN                                                NaN   \n2       NaN                         Water Institute Calculated   \n3        JQ  **JQ** The precision was outside the QC limit....   \n4       NaN                         Water Institute Calculated   \n...     ...                                                ...   \n1743    NaN                                                NaN   \n1744    NaN                                                NaN   \n1745    NaN                                                NaN   \n1746    NaN                                                NaN   \n1747    NaN                                                NaN   \n\n     Original_Result_Value  Original_Result_Unit  \n0                    0.096                  mg/l  \n1                    0.099                  mg/l  \n2                      NaN                   NaN  \n3                    0.170                  mg/l  \n4                      NaN                   NaN  \n...                    ...                   ...  \n1743                 0.111                  mg/L  \n1744                 1.100                  mg/L  \n1745                 1.260                  mg/L  \n1746                 0.096                  mg/L  \n1747                 1.290                  mg/L  \n\n[1748 rows x 21 columns]","content_type":"text/plain"}}},"children":[],"key":"TlYhCPfGhD"}],"key":"n7IEmrFNY6"}],"key":"PeTjywZbZr"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.2 Total Phosphorous Over Time (Outliers Removed)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I3Hn6Cthdv"}],"identifier":"id-2-2-total-phosphorous-over-time-outliers-removed","label":"2.2 Total Phosphorous Over Time (Outliers Removed)","html_id":"id-2-2-total-phosphorous-over-time-outliers-removed","implicit":true,"key":"Y6g6fBvO9F"}],"key":"zgB3RsCQQH"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section filters and visualizes TP data at the Olga station, removing outliers using the interquartile range (IQR) method. After converting values to numeric format and dropping any missing entries, the code calculates the lower and upper bounds for acceptable values and filters out extreme outliers. The cleaned data is then plotted as a time series.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vF7B9m9mvt"}],"key":"I6zYvqdoLC"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The resulting chart shows TP concentrations over time from approximately 1999 to 2024. The data appears sparse before 2015 but becomes more densely sampled in recent years. Most values cluster between 0.05 and 0.15 mg/L, with a slight downward trend and reduced variability over time—possibly reflecting changes in land use, management practices, or sampling consistency.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UH1Kv8i7rr"}],"key":"kVYhPPIT0y"}],"key":"colEfrrnaK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport matplotlib.pyplot as plt\n\n# --- 1. Load and Prepare Nutrient Data (Upper Caloosahatchee - Olga, FL) ---\nnutrient_data = pd.read_csv(\"TN_TP_Caloosa.csv\")  # or your local path\nnutrient_data['SampleDate'] = pd.to_datetime(nutrient_data['SampleDate'], errors='coerce')\n\n# Filter by correct nutrient labels (check spelling)\ntp_data_upper = nutrient_data[nutrient_data['Parameter'] == 'TP_mgl']\ntn_data_upper = nutrient_data[nutrient_data['Parameter'] == 'TN_mgl']\n\n# --- 2. Clean and Filter TP Data ---\ntp_data_upper['Result_Value'] = pd.to_numeric(tp_data_upper['Result_Value'], errors='coerce')\ntp_clean_upper = tp_data_upper.dropna(subset=['Result_Value'])\n\n# Detect and filter out outliers using IQR\nQ1_tp = tp_clean_upper['Result_Value'].quantile(0.25)\nQ3_tp = tp_clean_upper['Result_Value'].quantile(0.75)\nIQR_tp = Q3_tp - Q1_tp\n\ntp_filtered_upper = tp_clean_upper[\n    (tp_clean_upper['Result_Value'] >= Q1_tp - 1.5 * IQR_tp) &\n    (tp_clean_upper['Result_Value'] <= Q3_tp + 1.5 * IQR_tp)\n]\n\n# --- 3. Plot Filtered TP Data ---\nplt.figure(figsize=(10, 4))\nplt.scatter(tp_filtered_upper['SampleDate'], tp_filtered_upper['Result_Value'],\n            alpha=0.5, color='blue', label='Total Phosphorus (Filtered)')\nplt.title('Total Phosphorus (TP) Concentration Over Time (Outliers Removed) - Upper Caloosahatchee')\nplt.xlabel('Sample Date')\nplt.ylabel('TP (mg/L)')\nplt.grid(True)\nplt.legend()\nplt.tight_layout()\nplt.show()","key":"gNUvm0oXKA"},{"type":"outputs","id":"usfWOvUQAmUEeQF_r8VGu","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"C:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\3999490599.py:13: SettingWithCopyWarning: \nA value is trying to be set on a copy of a slice from a DataFrame.\nTry using .loc[row_indexer,col_indexer] = value instead\n\nSee the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n  tp_data_upper['Result_Value'] = pd.to_numeric(tp_data_upper['Result_Value'], errors='coerce')\n"},"children":[],"key":"N7jEytf8nw"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f08af60a7f2bc30cd0e56ea9346aba3d","path":"/red-tide-book//build/f08af60a7f2bc30cd0e56ea9346aba3d.png"},"text/plain":{"content":"<Figure size 1000x400 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"zd8TkpJ5N9"}],"key":"iAWlrStYxd"}],"key":"soYoUA4T0T"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.3 Total Nitrogen Over Time (Outliers Removed)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jyBC62R4uU"}],"identifier":"id-2-3-total-nitrogen-over-time-outliers-removed","label":"2.3 Total Nitrogen Over Time (Outliers Removed)","html_id":"id-2-3-total-nitrogen-over-time-outliers-removed","implicit":true,"key":"bAB6j9eSBW"}],"key":"IKDOjVwI93"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section processes TN data at the Olga station by converting result values to numeric format, dropping missing entries, and removing statistical outliers using the interquartile range (IQR) method. The filtered dataset is then plotted to visualize trends over time.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pxQkRZJfMP"}],"key":"ErW8svjxGT"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The resulting chart displays TN concentrations from the late 1990s through 2024. Like the phosphorus dataset, early records are sparse, with sampling density increasing significantly after 2015. Most values range between 1.0 and 1.6 mg/L. There is no obvious long-term trend, but a tighter clustering of values in more recent years may reflect improved monitoring consistency or reduced variability in nutrient inputs.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VBNlHS90YT"}],"key":"RNgVWY3J2s"}],"key":"kN9suDxifN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\n\n# Convert TN values to float\ntn_data_upper['Result_Value'] = pd.to_numeric(tn_data_upper['Result_Value'], errors='coerce')\n\n# Remove NaNs\ntn_clean_upper = tn_data_upper.dropna(subset=['Result_Value'])\n\n# Detect outliers using IQR\nQ1 = tn_clean_upper['Result_Value'].quantile(0.25)\nQ3 = tn_clean_upper['Result_Value'].quantile(0.75)\nIQR = Q3 - Q1\n\n# Filter out outliers\ntn_filtered_upper = tn_clean_upper[\n    (tn_clean_upper['Result_Value'] >= Q1 - 1.5 * IQR) &\n    (tn_clean_upper['Result_Value'] <= Q3 + 1.5 * IQR)\n]\n\n# Plot filtered TN data\nplt.figure(figsize=(10, 4))\nplt.scatter(tn_filtered_upper['SampleDate'], tn_filtered_upper['Result_Value'],\n            alpha=0.5, color='green', label='Total Nitrogen (Filtered)')\nplt.title('Total Nitrogen (TN) Concentration Over Time (Outliers Removed) - Upper Caloosahatchee')\nplt.xlabel('Sample Date')\nplt.ylabel('TN (mg/L)')\nplt.grid(True)\nplt.legend()\nplt.tight_layout()\nplt.show()","key":"NEudIANVMY"},{"type":"outputs","id":"EVILq2e-wFv9YVKnNdMsH","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"C:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\468480445.py:5: SettingWithCopyWarning: \nA value is trying to be set on a copy of a slice from a DataFrame.\nTry using .loc[row_indexer,col_indexer] = value instead\n\nSee the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n  tn_data_upper['Result_Value'] = pd.to_numeric(tn_data_upper['Result_Value'], errors='coerce')\n"},"children":[],"key":"g14PpluUFp"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5daddfc6b79a0f7f1641555a07ec0bc5","path":"/red-tide-book//build/5daddfc6b79a0f7f1641555a07ec0bc5.png"},"text/plain":{"content":"<Figure size 1000x400 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"FFgOncUcIp"}],"key":"Eq9IJC2xDQ"}],"key":"lnx5pL98Ku"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.4 Combined TN and TP Trendline, Olga, FL (Outliers Removed)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pAsAYt5aB2"}],"identifier":"id-2-4-combined-tn-and-tp-trendline-olga-fl-outliers-removed","label":"2.4 Combined TN and TP Trendline, Olga, FL (Outliers Removed)","html_id":"id-2-4-combined-tn-and-tp-trendline-olga-fl-outliers-removed","implicit":true,"key":"Z8uR4Le0kQ"}],"key":"EJpqGJLHMf"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section aggregates the cleaned nutrient data into monthly averages to reveal long-term trends in nitrogen and phosphorus concentrations at the Olga monitoring site. Missing months are interpolated to produce continuous time series for both parameters. The data is visualized in two synchronized subplots sharing the same time axis.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q42Cf06qm9"}],"key":"znjp29pWgl"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The top plot shows a monthly trend of TN concentrations, which fluctuate but show a general decline in variability and magnitude over the past two decades. The bottom plot illustrates the TP trend, which is more seasonally variable and features sharper peaks, especially in the mid-2000s and late 2010s. Together, these plots highlight nutrient dynamics over time and provide context for understanding their potential role in fueling algal blooms downstream.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GoiO439kSk"}],"key":"qoUMCzj8u6"}],"key":"IqJAGNrNRB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Resample monthly and interpolate missing months\ntn_monthly_upper = tn_filtered_upper.set_index('SampleDate')['Result_Value'].resample('M').mean().asfreq('M').interpolate()\ntp_monthly_upper = tp_filtered_upper.set_index('SampleDate')['Result_Value'].resample('M').mean().asfreq('M').interpolate()","key":"aYI52JesTJ"},{"type":"outputs","id":"vD2k0Ml1rpTQXsHmsgYde","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"C:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\2975870262.py:2: FutureWarning: 'M' is deprecated and will be removed in a future version, please use 'ME' instead.\n  tn_monthly_upper = tn_filtered_upper.set_index('SampleDate')['Result_Value'].resample('M').mean().asfreq('M').interpolate()\nC:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\2975870262.py:3: FutureWarning: 'M' is deprecated and will be removed in a future version, please use 'ME' instead.\n  tp_monthly_upper = tp_filtered_upper.set_index('SampleDate')['Result_Value'].resample('M').mean().asfreq('M').interpolate()\n"},"children":[],"key":"nRrsRMbnYf"}],"key":"cKFDdBIs3V"}],"key":"cjxtfh6k32"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\n# Plot TN and TP on two subplots (shared x-axis)\nfig, (ax1, ax2) = plt.subplots(2, 1, figsize=(14, 8), sharex=True)\n\n# Plot TN\nax1.plot(tn_monthly_upper.index, tn_monthly_upper.values, color='green', label='Total Nitrogen (TN)', linewidth=2)\nax1.set_ylabel('TN (mg/L)')\nax1.set_title('Monthly Trend of Total Nitrogen (Upper Caloosahatchee)')\nax1.grid(True)\nax1.legend()\n\n# Plot TP\nax2.plot(tp_monthly_upper.index, tp_monthly_upper.values, color='blue', label='Total Phosphorus (TP)', linewidth=2)\nax2.set_ylabel('TP (mg/L)')\nax2.set_title('Monthly Trend of Total Phosphorus (Upper Caloosahatchee)')\nax2.set_xlabel('Date')\nax2.grid(True)\nax2.legend()\n\nplt.tight_layout()\nplt.show()","key":"nKVYXU4HaD"},{"type":"outputs","id":"0B3R0zqthtBSefCbfD1KK","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b1b0746f7f61f5d4a11b30e0c446d5d4","path":"/red-tide-book//build/b1b0746f7f61f5d4a11b30e0c446d5d4.png"},"text/plain":{"content":"<Figure size 1400x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"hbRUsLCqyN"}],"key":"GrumsmBeMd"}],"key":"hCu80vMYhi"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.5 Nutrient Data: Lower Caloosahatchee (Fort Myers, FL)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zVdTdiEziE"}],"identifier":"id-2-5-nutrient-data-lower-caloosahatchee-fort-myers-fl","label":"2.5 Nutrient Data: Lower Caloosahatchee (Fort Myers, FL)","html_id":"id-2-5-nutrient-data-lower-caloosahatchee-fort-myers-fl","implicit":true,"key":"Aoc3A1LvI6"}],"key":"UF6aVcQHpm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section loads nutrient monitoring data for the tidal portion of the Caloosahatchee River near Fort Myers. As with the upper river data, this dataset includes TN and TP measurements and is used to complement the upstream records. Including this site allows the analysis to capture nutrient movement downstream, offering a fuller picture of how concentrations evolve as water flows from the Olga station toward the Gulf of Mexico.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sEPIfUvuor"}],"key":"Y8h9AMET30"}],"key":"WaVR2Mxwxn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\n\n# Load the Caloosahatchee nutrient data\nnutrient_tidal = pd.read_csv(\"TN_TP_Tidal_Caloosa.csv\")\n\n# Preview the dataset\nnutrient_tidal.head()","key":"hijoN6QEBl"},{"type":"outputs","id":"JT5ihkmufgth8B8mjOc8v","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>WBodyID</th>\n      <th>WaterBodyName</th>\n      <th>DataSource</th>\n      <th>StationID</th>\n      <th>StationName</th>\n      <th>Actual_StationID</th>\n      <th>Actual_Latitude</th>\n      <th>Actual_Longitude</th>\n      <th>DEP_WBID</th>\n      <th>SampleDate</th>\n      <th>...</th>\n      <th>DepthUnits</th>\n      <th>Parameter</th>\n      <th>Characteristic</th>\n      <th>Sample_Fraction</th>\n      <th>Result_Value</th>\n      <th>Result_Unit</th>\n      <th>QACode</th>\n      <th>Result_Comment</th>\n      <th>Original_Result_Value</th>\n      <th>Original_Result_Unit</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>9000108</td>\n      <td>Lower Tidal Caloosahatchee River</td>\n      <td>STORET_21FLEECO</td>\n      <td>DEEPGR10</td>\n      <td>DEEP LAGOON- McGregor Blvd.</td>\n      <td>DEEPGR10</td>\n      <td>26.53932</td>\n      <td>-81.9188</td>\n      <td>3240A</td>\n      <td>10/16/1990 0:00</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.16</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.16</td>\n      <td>mg/l</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>9000108</td>\n      <td>Lower Tidal Caloosahatchee River</td>\n      <td>STORET_21FLEECO</td>\n      <td>DEEPGR10</td>\n      <td>DEEP LAGOON- McGregor Blvd.</td>\n      <td>DEEPGR10</td>\n      <td>26.53932</td>\n      <td>-81.9188</td>\n      <td>3240A</td>\n      <td>10/16/1990 0:00</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TN_mgl</td>\n      <td>Nitrogen</td>\n      <td>Total</td>\n      <td>1.27</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>Water Institute Calculated: TKN + NOx</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>9000108</td>\n      <td>Lower Tidal Caloosahatchee River</td>\n      <td>STORET_21FLEECO</td>\n      <td>DEEPGR10</td>\n      <td>DEEP LAGOON- McGregor Blvd.</td>\n      <td>DEEPGR10</td>\n      <td>26.53932</td>\n      <td>-81.9188</td>\n      <td>3240A</td>\n      <td>10/31/1990 0:00</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TN_mgl</td>\n      <td>Nitrogen</td>\n      <td>Total</td>\n      <td>4.77</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>Water Institute Calculated: TKN + NOx</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>9000108</td>\n      <td>Lower Tidal Caloosahatchee River</td>\n      <td>STORET_21FLEECO</td>\n      <td>DEEPGR10</td>\n      <td>DEEP LAGOON- McGregor Blvd.</td>\n      <td>DEEPGR10</td>\n      <td>26.53932</td>\n      <td>-81.9188</td>\n      <td>3240A</td>\n      <td>10/31/1990 0:00</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.10</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.10</td>\n      <td>mg/l</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>9000108</td>\n      <td>Lower Tidal Caloosahatchee River</td>\n      <td>STORET_21FLEECO</td>\n      <td>DEEPGR10</td>\n      <td>DEEP LAGOON- McGregor Blvd.</td>\n      <td>DEEPGR10</td>\n      <td>26.53932</td>\n      <td>-81.9188</td>\n      <td>3240A</td>\n      <td>11/19/1990 0:00</td>\n      <td>...</td>\n      <td>m</td>\n      <td>TP_mgl</td>\n      <td>Phosphorus as P</td>\n      <td>Total</td>\n      <td>0.11</td>\n      <td>mg/l</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.11</td>\n      <td>mg/l</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows × 21 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"   WBodyID                     WaterBodyName       DataSource StationID  \\\n0  9000108  Lower Tidal Caloosahatchee River  STORET_21FLEECO  DEEPGR10   \n1  9000108  Lower Tidal Caloosahatchee River  STORET_21FLEECO  DEEPGR10   \n2  9000108  Lower Tidal Caloosahatchee River  STORET_21FLEECO  DEEPGR10   \n3  9000108  Lower Tidal Caloosahatchee River  STORET_21FLEECO  DEEPGR10   \n4  9000108  Lower Tidal Caloosahatchee River  STORET_21FLEECO  DEEPGR10   \n\n                    StationName Actual_StationID  Actual_Latitude  \\\n0   DEEP LAGOON- McGregor Blvd.         DEEPGR10         26.53932   \n1   DEEP LAGOON- McGregor Blvd.         DEEPGR10         26.53932   \n2   DEEP LAGOON- McGregor Blvd.         DEEPGR10         26.53932   \n3   DEEP LAGOON- McGregor Blvd.         DEEPGR10         26.53932   \n4   DEEP LAGOON- McGregor Blvd.         DEEPGR10         26.53932   \n\n   Actual_Longitude DEP_WBID       SampleDate  ...  DepthUnits Parameter  \\\n0          -81.9188    3240A  10/16/1990 0:00  ...           m    TP_mgl   \n1          -81.9188    3240A  10/16/1990 0:00  ...           m    TN_mgl   \n2          -81.9188    3240A  10/31/1990 0:00  ...           m    TN_mgl   \n3          -81.9188    3240A  10/31/1990 0:00  ...           m    TP_mgl   \n4          -81.9188    3240A  11/19/1990 0:00  ...           m    TP_mgl   \n\n    Characteristic Sample_Fraction Result_Value  Result_Unit QACode  \\\n0  Phosphorus as P           Total         0.16         mg/l    NaN   \n1         Nitrogen           Total         1.27         mg/l    NaN   \n2         Nitrogen           Total         4.77         mg/l    NaN   \n3  Phosphorus as P           Total         0.10         mg/l    NaN   \n4  Phosphorus as P           Total         0.11         mg/l    NaN   \n\n                          Result_Comment Original_Result_Value  \\\n0                                    NaN                  0.16   \n1  Water Institute Calculated: TKN + NOx                   NaN   \n2  Water Institute Calculated: TKN + NOx                   NaN   \n3                                    NaN                  0.10   \n4                                    NaN                  0.11   \n\n   Original_Result_Unit  \n0                  mg/l  \n1                   NaN  \n2                   NaN  \n3                  mg/l  \n4                  mg/l  \n\n[5 rows x 21 columns]","content_type":"text/plain"}}},"children":[],"key":"T08NfhAu0q"}],"key":"bxYvjhMxzV"}],"key":"Dg8b97zIdx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.6 Total Phosphorous Over Time (Outliers Removed)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"InoKEMjnOL"}],"identifier":"id-2-6-total-phosphorous-over-time-outliers-removed","label":"2.6 Total Phosphorous Over Time (Outliers Removed)","html_id":"id-2-6-total-phosphorous-over-time-outliers-removed","implicit":true,"key":"AhhdJ6cOc2"}],"key":"kjiF50OhzK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section repeats the methods of Section 2.2 for the tidal Caloosahatchee River.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f5fpqxKzdR"}],"key":"WfuTWKe2Y7"}],"key":"dbg5JpPXG4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport pandas as pd\nimport numpy as np\n\n# Strip any trailing/leading whitespace from column names\nnutrient_tidal.columns = nutrient_tidal.columns.str.strip()\n\n# --- Convert TP values to numeric ---\ntp_data_tidal = nutrient_tidal[nutrient_tidal['Parameter'] == 'TP_mgl'].copy()\ntp_data_tidal['Result_Value'] = pd.to_numeric(tp_data_tidal['Result_Value'], errors='coerce')\ntp_data_tidal['SampleDate'] = pd.to_datetime(tp_data_tidal['SampleDate'], errors='coerce')\n\n# --- Remove NaNs ---\ntp_clean_tidal = tp_data_tidal.dropna(subset=['Result_Value'])\n\n# --- Detect outliers using IQR ---\nQ1_tp = tp_clean_tidal['Result_Value'].quantile(0.25)\nQ3_tp = tp_clean_tidal['Result_Value'].quantile(0.75)\nIQR_tp = Q3_tp - Q1_tp\n\n# --- Filter out outliers ---\ntp_filtered_tidal = tp_clean_tidal[\n    (tp_clean_tidal['Result_Value'] >= Q1_tp - 1.5 * IQR_tp) &\n    (tp_clean_tidal['Result_Value'] <= Q3_tp + 1.5 * IQR_tp)\n]\n\n# --- Plot Filtered TP data ---\nplt.figure(figsize=(10, 4))\nplt.scatter(tp_filtered_tidal['SampleDate'], tp_filtered_tidal['Result_Value'], \n            alpha=0.5, color='blue', label='Total Phosphorus (Filtered)')\nplt.title('Total Phosphorus (TP) Concentration Over Time (Outliers Removed) - Tidal Caloosahatchee')\nplt.xlabel('Sample Date')\nplt.ylabel('TP (mg/L)')\nplt.grid(True)\nplt.legend()\nplt.tight_layout()\nplt.show()","key":"nYZ98lDJxM"},{"type":"outputs","id":"wQy9K0mtBaKcbNVkkBoyH","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a3be7f318b0f0fca77ab517aa68da786","path":"/red-tide-book//build/a3be7f318b0f0fca77ab517aa68da786.png"},"text/plain":{"content":"<Figure size 1000x400 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"a7kjUsdkdr"}],"key":"NC0m8UJhfl"}],"key":"V5oOpP6u2K"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.7 Total Nitrogen Over Time (Outliers Removed)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E38JlckmIi"}],"identifier":"id-2-7-total-nitrogen-over-time-outliers-removed","label":"2.7 Total Nitrogen Over Time (Outliers Removed)","html_id":"id-2-7-total-nitrogen-over-time-outliers-removed","implicit":true,"key":"uCEpHVybQ4"}],"key":"fFu9uFQr2M"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section repeats the methods of Section 2.3 for the tidal Caloosahatchee River.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l2bPZSCYJ7"}],"key":"zcAE4Abcit"}],"key":"ql5b8SOZA5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\n\n# Filter and convert TN values\ntn_data_tidal = nutrient_tidal[nutrient_tidal['Parameter'] == 'TN_mgl'].copy()\ntn_data_tidal['Result_Value'] = pd.to_numeric(tn_data_tidal['Result_Value'], errors='coerce')\ntn_data_tidal['SampleDate'] = pd.to_datetime(tn_data_tidal['SampleDate'], errors='coerce')\n\n# Remove NaNs\ntn_clean_tidal = tn_data_tidal.dropna(subset=['Result_Value'])\n\n# Detect outliers using IQR\nQ1_tn_tidal = tn_clean_tidal['Result_Value'].quantile(0.25)\nQ3_tn_tidal = tn_clean_tidal['Result_Value'].quantile(0.75)\nIQR_tn_tidal = Q3_tn_tidal - Q1_tn_tidal\n\n# Filter out outliers\ntn_filtered_tidal = tn_clean_tidal[\n    (tn_clean_tidal['Result_Value'] >= Q1_tn_tidal - 1.5 * IQR_tn_tidal) &\n    (tn_clean_tidal['Result_Value'] <= Q3_tn_tidal + 1.5 * IQR_tn_tidal)\n]\n\n# Plot Filtered TN data\nplt.figure(figsize=(10, 4))\nplt.scatter(tn_filtered_tidal['SampleDate'], tn_filtered_tidal['Result_Value'], \n            alpha=0.5, color='green', label='Total Nitrogen (Filtered)')\nplt.title('Total Nitrogen (TN) Concentration Over Time (Outliers Removed) - Tidal Caloosahatchee')\nplt.xlabel('Sample Date')\nplt.ylabel('TN (mg/L)')\nplt.grid(True)\nplt.legend()\nplt.tight_layout()\nplt.show()","key":"iJ9qpKtVRA"},{"type":"outputs","id":"7omY0lgTpdet-jhfNUJhy","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7b91cdb1188f6aafc68a91d878c46b9f","path":"/red-tide-book//build/7b91cdb1188f6aafc68a91d878c46b9f.png"},"text/plain":{"content":"<Figure size 1000x400 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"mlt4IesG4d"}],"key":"rtUOJVda9L"}],"key":"On5kZ6BaPq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.8 Combined TN and TP Trendline, Fort Myers (Outliers Removed)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VVzu6JqkXU"}],"identifier":"id-2-8-combined-tn-and-tp-trendline-fort-myers-outliers-removed","label":"2.8 Combined TN and TP Trendline, Fort Myers (Outliers Removed)","html_id":"id-2-8-combined-tn-and-tp-trendline-fort-myers-outliers-removed","implicit":true,"key":"Z6F1SfXexN"}],"key":"eb0R1dDc0T"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This section repeats the methods of Section 2.4 for the tidal Caloosahatchee River.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wcZnZv7MNx"}],"key":"HV2QHVfroz"}],"key":"i736RQhtKz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# --- Resample monthly and interpolate missing months for Tidal Caloosahatchee ---\ntn_monthly_tidal = tn_filtered_tidal.set_index('SampleDate')['Result_Value'] \\\n    .resample('M').mean().asfreq('M').interpolate()\n\ntp_monthly_tidal = tp_filtered_tidal.set_index('SampleDate')['Result_Value'] \\\n    .resample('M').mean().asfreq('M').interpolate()","key":"q5rO68Zc2E"},{"type":"outputs","id":"sFKq0g8UFI3FlVZssiEfe","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"C:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\4036337590.py:3: FutureWarning: 'M' is deprecated and will be removed in a future version, please use 'ME' instead.\n  .resample('M').mean().asfreq('M').interpolate()\nC:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\4036337590.py:6: FutureWarning: 'M' is deprecated and will be removed in a future version, please use 'ME' instead.\n  .resample('M').mean().asfreq('M').interpolate()\n"},"children":[],"key":"PK6WOEHDEk"}],"key":"fRyRDSu6rD"}],"key":"OlI6amYycI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\n# --- Plot TN and TP trends for Tidal Caloosahatchee in stacked subplots ---\nfig, (ax1, ax2) = plt.subplots(2, 1, figsize=(14, 8), sharex=True)\n\n# TN plot\nax1.plot(tn_monthly_tidal.index, tn_monthly_tidal.values, color='green', linewidth=2, label='Total Nitrogen (TN)')\nax1.set_ylabel('TN (mg/L)')\nax1.set_title('Monthly Trend of Total Nitrogen (Tidal Caloosahatchee)')\nax1.grid(True)\nax1.legend()\n\n# TP plot\nax2.plot(tp_monthly_tidal.index, tp_monthly_tidal.values, color='blue', linewidth=2, label='Total Phosphorus (TP)')\nax2.set_ylabel('TP (mg/L)')\nax2.set_title('Monthly Trend of Total Phosphorus (Tidal Caloosahatchee)')\nax2.set_xlabel('Date')\nax2.grid(True)\nax2.legend()\n\nplt.tight_layout()\nplt.show()","key":"GS117SpHvu"},{"type":"outputs","id":"c9Jp__G_C6NBccnfuaFRf","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c569154706f47f7f1725206640f5f995","path":"/red-tide-book//build/c569154706f47f7f1725206640f5f995.png"},"text/plain":{"content":"<Figure size 1400x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"lpr7unsOI9"}],"key":"RWpYjIaMPn"}],"key":"VMvOpoYzTn"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.9 Combined and Averaged Time Series for the Caloosahatchee River","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IR8esMOlHk"}],"identifier":"id-2-9-combined-and-averaged-time-series-for-the-caloosahatchee-river","label":"2.9 Combined and Averaged Time Series for the Caloosahatchee River","html_id":"id-2-9-combined-and-averaged-time-series-for-the-caloosahatchee-river","implicit":true,"key":"OUfu4KLToW"}],"key":"n6BRsPDQ3u"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To better support the machine learning analysis, we combined the TN and TP data from both the upper (Olga) and lower (Fort Myers) Caloosahatchee River sites.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HlZHdBuVo1"}],"key":"Uy5z6oE083"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This was done by averaging the monthly resampled and interpolated TN and TP concentrations from both locations. The result is a single, unified timeseries for TN and TP that represents the average nutrient concentrations flowing out of the Caloosahatchee River.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KuQNNRIGOR"}],"key":"Z4ezkIJqLX"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This provides a more comprehensive and simplified input for evaluating how nutrient levels may correlate with harmful algal bloom (HAB) activity in downstream coastal waters.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NWyxm8ooUm"}],"key":"ttHhKaB2aE"}],"key":"vpxBAjqEF1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# --- Combine and average monthly TN and TP data from upper and tidal Caloosahatchee ---\n\n# First align the date indices to ensure no mismatch\ntn_monthly_upper = tn_monthly_upper.sort_index()\ntp_monthly_upper = tp_monthly_upper.sort_index()\ntn_monthly_tidal = tn_monthly_tidal.sort_index()\ntp_monthly_tidal = tp_monthly_tidal.sort_index()\n\n# Align on same monthly date index (outer join, then take average where both exist)\ncombined_tn = pd.concat([tn_monthly_upper, tn_monthly_tidal], axis=1)\ncombined_tp = pd.concat([tp_monthly_upper, tp_monthly_tidal], axis=1)\n\n# Rename columns for clarity\ncombined_tn.columns = ['TN_Upper', 'TN_Tidal']\ncombined_tp.columns = ['TP_Upper', 'TP_Tidal']\n\n# Take the average (will ignore NaN if one side is missing)\ncombined_tn['TN_Avg'] = combined_tn.mean(axis=1)\ncombined_tp['TP_Avg'] = combined_tp.mean(axis=1)\n\n# Extract final single-column Series for modeling\ntn_avg = combined_tn['TN_Avg']\ntp_avg = combined_tp['TP_Avg']","key":"S2tRAvxcfL"},{"type":"outputs","id":"SVMPuBRSrWTYqVJiqrcVX","children":[],"key":"lVGqG8y0lE"}],"key":"CsUtgmCKWL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\n# Create side-by-side subplots\nfig, (ax1, ax2) = plt.subplots(2, 1, figsize=(14, 8), sharex=True)\n\n# Plot TN\nax1.plot(tn_avg.index, tn_avg.values, color='green', linewidth=2, label='Avg Total Nitrogen (TN)')\nax1.set_ylabel('TN (mg/L)')\nax1.set_title('Monthly Average Total Nitrogen from Caloosahatchee River')\nax1.grid(True)\nax1.legend()\n\n# Plot TP\nax2.plot(tp_avg.index, tp_avg.values, color='blue', linewidth=2, label='Avg Total Phosphorus (TP)')\nax2.set_ylabel('TP (mg/L)')\nax2.set_title('Monthly Average Total Phosphorus from Caloosahatchee River')\nax2.set_xlabel('Date')\nax2.grid(True)\nax2.legend()\n\nplt.tight_layout()\nplt.show()","key":"GGvsnZYCtw"},{"type":"outputs","id":"pkn5OnLdrP0CHAVJ8uFN-","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0c7764694db0f4a8b19c9b934e921196","path":"/red-tide-book//build/0c7764694db0f4a8b19c9b934e921196.png"},"text/plain":{"content":"<Figure size 1400x800 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"AnX2waUSws"}],"key":"yeiKm9kLSW"}],"key":"CHCFjNEh81"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3. Resampling Caloosahatchee TN and TP to Match Peace River","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GCISVB1a1a"}],"identifier":"id-3-resampling-caloosahatchee-tn-and-tp-to-match-peace-river","label":"3. Resampling Caloosahatchee TN and TP to Match Peace River","html_id":"id-3-resampling-caloosahatchee-tn-and-tp-to-match-peace-river","implicit":true,"key":"AIb4bFqRUT"}],"key":"aku8XiDVRd"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"There are discrepancies between the Peace River and Caloosahatchee River TN and TP datasets. Namely, the Peace River TN and TP is sampled daily and is measured in ugl, while the Caloosahatchee River TN and TP is averaged monthly and measured in mgl. The following code updates the Caloosahatchee River data to match the Peace River data in preparation for creating a feature file to be used in the Peace River code.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SXgtmPOvzv"}],"key":"IfXNkCZOQ3"}],"key":"kr1QvQtlzJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\n\n# --- Load upper and tidal nutrient data ---\ndf_upper = pd.read_csv(\"TN_TP_Caloosa.csv\")\ndf_tidal = pd.read_csv(\"TN_TP_Tidal_Caloosa.csv\")\n\ndef prepare_daily_nutrient_series(df, tn_code='TN_mgl', tp_code='TP_mgl'):\n    df = df.copy()\n\n    # Convert to datetime\n    df['SampleDate'] = pd.to_datetime(df['SampleDate'])\n\n    # Filter for TN and TP\n    df_tn = df[df['Parameter'] == tn_code][['SampleDate', 'Result_Value']].copy()\n    df_tp = df[df['Parameter'] == tp_code][['SampleDate', 'Result_Value']].copy()\n\n    # Convert mg/L to µg/L\n    df_tn['Result_Value'] *= 1000\n    df_tp['Result_Value'] *= 1000\n\n    # Group by date and average if more than one reading per day\n    tn_daily = df_tn.groupby('SampleDate').mean()\n    tp_daily = df_tp.groupby('SampleDate').mean()\n\n    # Reindex to full date range and interpolate missing days\n    full_range = pd.date_range(start=df['SampleDate'].min(), end=df['SampleDate'].max(), freq='D')\n    tn_daily = tn_daily.reindex(full_range).interpolate()\n    tp_daily = tp_daily.reindex(full_range).interpolate()\n\n    # Rename columns for clarity\n    tn_daily.columns = ['TN']\n    tp_daily.columns = ['TP']\n\n    return tn_daily, tp_daily\n\n# --- Prepare upper and tidal separately ---\ntn_upper, tp_upper = prepare_daily_nutrient_series(df_upper)\ntn_tidal, tp_tidal = prepare_daily_nutrient_series(df_tidal)\n\n# --- Combine and average across stations ---\ncombined_tn = pd.concat([tn_upper, tn_tidal], axis=1)\ncombined_tp = pd.concat([tp_upper, tp_tidal], axis=1)\n\ncombined_tn.columns = ['TN_Upper', 'TN_Tidal']\ncombined_tp.columns = ['TP_Upper', 'TP_Tidal']\n\n# Take the daily average (ignores NaN if only one site sampled)\ncombined_tn['TN_Avg'] = combined_tn.mean(axis=1)\ncombined_tp['TP_Avg'] = combined_tp.mean(axis=1)\n\n# Extract final time series\ntn_avg = combined_tn[['TN_Avg']]\ntp_avg = combined_tp[['TP_Avg']]\n\n# Optional: merge into one DataFrame\ndf_nutrients_daily = pd.concat([tn_avg, tp_avg], axis=1)\n\n# View result\nprint(df_nutrients_daily.head())\n","key":"yacEgyCHvX"},{"type":"outputs","id":"wpluqvfRqlF85gj4SHhvt","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"                 TN_Avg  TP_Avg\n1990-10-16  1270.000000   160.0\n1990-10-17  1503.333333   156.0\n1990-10-18  1736.666667   152.0\n1990-10-19  1970.000000   148.0\n1990-10-20  2203.333333   144.0\n"},"children":[],"key":"fLZtHKmoxs"}],"key":"Ii0ESCGgbQ"}],"key":"TgpPeQfg3V"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4. Combine Discharge and TN/TP Data Frames","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xh8BdvO6KM"}],"identifier":"id-4-combine-discharge-and-tn-tp-data-frames","label":"4. Combine Discharge and TN/TP Data Frames","html_id":"id-4-combine-discharge-and-tn-tp-data-frames","implicit":true,"key":"wRHHRS9Vjg"}],"key":"F9UuTUeNBi"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Below, we combined daily-averaged discharge, total nitrogen, and total phosphorus data into a unified feature set. Discharge was downsampled to match the monthly resolution of the nutrient data. This dataset captures key flow and nutrient conditions from the Caloosahatchee River system and is structured to match the Peace River format for ML modeling.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cDGvULFplf"}],"key":"INUl0O6JCR"}],"key":"WY7LaJDFdA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(df_dis.index)\nprint(df_nutrients_daily.index)","key":"Is39Vx6Tmb"},{"type":"outputs","id":"gZT7vTPpCgnGmCshQpDg6","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"RangeIndex(start=0, stop=11783, step=1)\nDatetimeIndex(['1990-10-16', '1990-10-17', '1990-10-18', '1990-10-19',\n               '1990-10-20', '1990-10-21', '1990-10-22', '1990-10-23',\n               '1990-10-24', '1990-10-25',\n               ...\n               '2025-01-04', '2025-01-05', '2025-01-06', '2025-01-07',\n               '2025-01-08', '2025-01-09', '2025-01-10', '2025-01-11',\n               '2025-01-12', '2025-01-13'],\n              dtype='datetime64[ns]', length=12509, freq='D')\n"},"children":[],"key":"SxFiotcdPK"}],"key":"eRwhQO3iaN"}],"key":"hmJOBfse7r"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Convert df_dis['Date'] to datetime and set it as index\ndf_dis['Date'] = pd.to_datetime(df_dis['Date'])\ndf_dis.set_index('Date', inplace=True)\n\n# Make sure df_nutrients_daily index is also datetime (you've already done this)\ndf_nutrients_daily.index = pd.to_datetime(df_nutrients_daily.index)\n\n# Now safely concatenate based on the datetime index\ndf_combined = pd.concat([df_dis, df_nutrients_daily], axis=1, join='inner')  # only keeps overlapping dates\n\n# Drop any remaining NaNs if needed\ndf_combined.dropna(inplace=True)\n\n# Check results\nprint(df_combined.head())","key":"aehHzt9Dca"},{"type":"outputs","id":"4aQQ6AjpkcbZKUQF7lJBd","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"           Source  Site Number Discharge       TN_Avg  TP_Avg\n1993-01-01   USGS      2292900      14.0  1126.071429    70.0\n1993-01-02   USGS      2292900     160.0  1076.428571    70.0\n1993-01-03   USGS      2292900     820.0  1026.785714    70.0\n1993-01-04   USGS      2292900      11.0   977.142857    70.0\n1993-01-05   USGS      2292900       9.2   927.500000    70.0\n"},"children":[],"key":"FBmvKwwiw3"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"C:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\534825520.py:2: SettingWithCopyWarning: \nA value is trying to be set on a copy of a slice from a DataFrame.\nTry using .loc[row_indexer,col_indexer] = value instead\n\nSee the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n  df_dis['Date'] = pd.to_datetime(df_dis['Date'])\n"},"children":[],"key":"m3zpYoaF0C"}],"key":"ZdjBBBcDmc"}],"key":"g1S6apxTVw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Ensure Date column is present and set as datetime index for df_dis\ndf_dis = df_dis.copy()\nif df_dis.index.name == 'Date':\n    df_dis.reset_index(inplace=True)  # brings 'Date' back as a column\n\ndf_dis['Date'] = pd.to_datetime(df_dis['Date'])  # ensure datetime format\ndf_dis.set_index('Date', inplace=True)  # set as index for alignment\n\n# Ensure df_nutrients_daily index is datetime\ndf_nutrients_daily.index = pd.to_datetime(df_nutrients_daily.index)\n\n# Concatenate on aligned datetime index\ndf_combined = pd.concat([df_dis, df_nutrients_daily], axis=1, join='inner')\n\n# Rename nutrient columns to match ML features\ndf_combined.rename(columns={\n    'TN_Avg': 'caloosa_total_nitrogen',\n    'TP_Avg': 'caloosa_total_phosphorus'\n}, inplace=True)\n\n# Drop rows with missing data\ndf_combined.dropna(inplace=True)\n\n# Reset index so 'Date' becomes a column again\ndf_combined.reset_index(inplace=True)\n\n# Confirm the column is actually named 'Date'\nprint(df_combined.columns)\n\n# Save to CSV (no need to reselect columns if they're already right)\ndf_combined.to_csv('caloosa_features.csv', index=False)\n\n# View result\nprint(df_combined.head())","key":"LZfTGeSrAE"},{"type":"outputs","id":"xpikaFcERH3OhTBvvc_xV","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Index(['index', 'Source', 'Site Number', 'Discharge', 'caloosa_total_nitrogen',\n       'caloosa_total_phosphorus'],\n      dtype='object')\n       index Source  Site Number Discharge  caloosa_total_nitrogen  \\\n0 1993-01-01   USGS      2292900      14.0             1126.071429   \n1 1993-01-02   USGS      2292900     160.0             1076.428571   \n2 1993-01-03   USGS      2292900     820.0             1026.785714   \n3 1993-01-04   USGS      2292900      11.0              977.142857   \n4 1993-01-05   USGS      2292900       9.2              927.500000   \n\n   caloosa_total_phosphorus  \n0                      70.0  \n1                      70.0  \n2                      70.0  \n3                      70.0  \n4                      70.0  \n"},"children":[],"key":"MnhPpLFcis"}],"key":"fvJJDlmYYr"}],"key":"Z8qEB2AWuP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Reset index so 'Date' becomes a column again\ndf_combined.reset_index(inplace=True)\n\n# Rename the index column to 'Date' explicitly\ndf_combined.rename(columns={'index': 'Date'}, inplace=True)\n\n# Optional: reorder columns\ndf_combined = df_combined[['Date', 'Discharge', 'caloosa_total_nitrogen', 'caloosa_total_phosphorus']]\n\n# Save to CSV\ndf_combined.to_csv('caloosa_features.csv', index=False)\n\n# Preview\nprint(df_combined.head())","key":"DmV5uCYm8k"},{"type":"outputs","id":"HBecGaLx7HVjxWUp3qTaA","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"        Date Discharge  caloosa_total_nitrogen  caloosa_total_phosphorus\n0 1993-01-01      14.0             1126.071429                      70.0\n1 1993-01-02     160.0             1076.428571                      70.0\n2 1993-01-03     820.0             1026.785714                      70.0\n3 1993-01-04      11.0              977.142857                      70.0\n4 1993-01-05       9.2              927.500000                      70.0\n"},"children":[],"key":"tIQyPUY6uV"}],"key":"ZHAObyIlxH"}],"key":"YxkFRzV8ZD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Rename 'Discharge' to match naming convention\ndf_combined.rename(columns={'Discharge': 'caloosa_discharge'}, inplace=True)\ndf_combined.head()","key":"Sxa7mn5WWA"},{"type":"outputs","id":"Ls0Aulw-gXzG4qveBiMFm","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Date</th>\n      <th>caloosa_discharge</th>\n      <th>caloosa_total_nitrogen</th>\n      <th>caloosa_total_phosphorus</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1993-01-01</td>\n      <td>14.0</td>\n      <td>1126.071429</td>\n      <td>70.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1993-01-02</td>\n      <td>160.0</td>\n      <td>1076.428571</td>\n      <td>70.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1993-01-03</td>\n      <td>820.0</td>\n      <td>1026.785714</td>\n      <td>70.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1993-01-04</td>\n      <td>11.0</td>\n      <td>977.142857</td>\n      <td>70.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1993-01-05</td>\n      <td>9.2</td>\n      <td>927.500000</td>\n      <td>70.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"        Date caloosa_discharge  caloosa_total_nitrogen  \\\n0 1993-01-01              14.0             1126.071429   \n1 1993-01-02             160.0             1076.428571   \n2 1993-01-03             820.0             1026.785714   \n3 1993-01-04              11.0              977.142857   \n4 1993-01-05               9.2              927.500000   \n\n   caloosa_total_phosphorus  \n0                      70.0  \n1                      70.0  \n2                      70.0  \n3                      70.0  \n4                      70.0  ","content_type":"text/plain"}}},"children":[],"key":"runQgRc5II"}],"key":"FqQJT76f1Z"}],"key":"fG1KGvFwcm"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4. Create Caloosahatchee Features File","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HsxN3XmoXC"}],"identifier":"id-4-create-caloosahatchee-features-file","label":"4. Create Caloosahatchee Features File","html_id":"id-4-create-caloosahatchee-features-file","implicit":true,"key":"t9dZh8c3vV"}],"key":"C2yApEGiF6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Restore date column for resampling\ndf_combined = pd.read_csv('caloosa_features.csv')  # Reload if needed\ndf_combined['Date'] = pd.to_datetime(df_combined['Date'])  # Ensure proper datetime type\ndf_combined.set_index('Date', inplace=True)  # Set Date as index for resampling\n# Rename 'Discharge' to match naming convention\ndf_combined.rename(columns={'Discharge': 'caloosa_discharge'}, inplace=True)\ndf_combined.head()","key":"HHq46muzcs"},{"type":"outputs","id":"_AGt5ddwvWCsLLF7o31lW","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":31,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>caloosa_discharge</th>\n      <th>caloosa_total_nitrogen</th>\n      <th>caloosa_total_phosphorus</th>\n    </tr>\n    <tr>\n      <th>Date</th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1993-01-01</th>\n      <td>14.0</td>\n      <td>1126.071429</td>\n      <td>70.0</td>\n    </tr>\n    <tr>\n      <th>1993-01-02</th>\n      <td>160.0</td>\n      <td>1076.428571</td>\n      <td>70.0</td>\n    </tr>\n    <tr>\n      <th>1993-01-03</th>\n      <td>820.0</td>\n      <td>1026.785714</td>\n      <td>70.0</td>\n    </tr>\n    <tr>\n      <th>1993-01-04</th>\n      <td>11.0</td>\n      <td>977.142857</td>\n      <td>70.0</td>\n    </tr>\n    <tr>\n      <th>1993-01-05</th>\n      <td>9.2</td>\n      <td>927.500000</td>\n      <td>70.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"            caloosa_discharge  caloosa_total_nitrogen  \\\nDate                                                    \n1993-01-01               14.0             1126.071429   \n1993-01-02              160.0             1076.428571   \n1993-01-03              820.0             1026.785714   \n1993-01-04               11.0              977.142857   \n1993-01-05                9.2              927.500000   \n\n            caloosa_total_phosphorus  \nDate                                  \n1993-01-01                      70.0  \n1993-01-02                      70.0  \n1993-01-03                      70.0  \n1993-01-04                      70.0  \n1993-01-05                      70.0  ","content_type":"text/plain"}}},"children":[],"key":"besJnJ7ZUg"}],"key":"aRztdKIwIZ"}],"key":"enGa3Lq7ZM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"5. Resample Caloosahatchee Data to Weekly","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dyRR67sQhX"}],"identifier":"id-5-resample-caloosahatchee-data-to-weekly","label":"5. Resample Caloosahatchee Data to Weekly","html_id":"id-5-resample-caloosahatchee-data-to-weekly","implicit":true,"key":"K8vdkTI5uW"}],"key":"bnLVW0vpnV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The final data for the Peace River parameters is interpolated weekly, so we need to resample the Calooshatchee data to weekly.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I2ViBDVkvb"}],"key":"wEWjCzBQgB"}],"key":"lQwTco2rxJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Resample to weekly (Monday start) using mean for each variable\ndf_caloosa_weekly = df_combined.resample('W-MON').mean()\n\n# Optional: check the result\nprint(df_caloosa_weekly.head())\n\n# Save as a new weekly file to match the professor's format\ndf_caloosa_weekly.to_csv('caloosa_weekly.csv')\n","key":"CUncnjVXgK"},{"type":"outputs","id":"DLf0_NDg2OmQScxscIr6g","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"            caloosa_discharge  caloosa_total_nitrogen  \\\nDate                                                    \n1993-01-04         251.250000             1051.607143   \n1993-01-11        1528.600000              778.571429   \n1993-01-18        3398.571429              792.936508   \n1993-01-25        2687.000000              798.333333   \n1993-02-01        2979.142857              765.925926   \n\n            caloosa_total_phosphorus  \nDate                                  \n1993-01-04                 70.000000  \n1993-01-11                 70.000000  \n1993-01-18                 67.142857  \n1993-01-25                 58.000000  \n1993-02-01                 48.666667  \n"},"children":[],"key":"mQOjvYIsjm"}],"key":"Dzyo7gLYtB"}],"key":"pQxxgW6VEm"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"5.1 Add Time Column to Caloosahatchee Dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B0SKRLhfnr"}],"identifier":"id-5-1-add-time-column-to-caloosahatchee-dataset","label":"5.1 Add Time Column to Caloosahatchee Dataset","html_id":"id-5-1-add-time-column-to-caloosahatchee-dataset","implicit":true,"key":"olPvA1bPtS"}],"key":"NPQxq869qP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\n\n# Load Caloosahatchee data with datetime index\ndf_caloosa = pd.read_csv('caloosa_weekly.csv', index_col=0, parse_dates=True)\n\n# Add 'time' column from index\ndf_caloosa['time'] = df_caloosa.index\n\n# Optional: move 'time' to the front\ndf_caloosa = df_caloosa[['time', 'caloosa_discharge', 'caloosa_total_nitrogen', 'caloosa_total_phosphorus']]\n\n# Save updated file\ndf_caloosa.to_csv('caloosa_weekly_with_time.csv', index=False)","key":"xsKAxEfp5R"},{"type":"outputs","id":"uglSNaeHG-hCakPutHPX0","children":[],"key":"P803SGE2D7"}],"key":"obwuiV3A1Q"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"5.2 Convert Caloosa TN and TP to mg/L","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mk4OsP8XpF"}],"identifier":"id-5-2-convert-caloosa-tn-and-tp-to-mg-l","label":"5.2 Convert Caloosa TN and TP to mg/L","html_id":"id-5-2-convert-caloosa-tn-and-tp-to-mg-l","implicit":true,"key":"Jgo5nn7TcW"}],"key":"Gow9CnjlQ9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Load Caloosahatchee features with time column\ndf_caloosa = pd.read_csv(\"caloosa_weekly_with_time.csv\", parse_dates=['time'])\n\n# Convert TN and TP from µg/L to mg/L\ndf_caloosa['caloosa_total_nitrogen'] = df_caloosa['caloosa_total_nitrogen'] / 1000\ndf_caloosa['caloosa_total_phosphorus'] = df_caloosa['caloosa_total_phosphorus'] / 1000\n\n# Save updated version (overwrites file with corrected units)\ndf_caloosa.to_csv(\"caloosa_weekly_with_time.csv\", index=False)","key":"oPXJokiZeh"},{"type":"outputs","id":"RqfKUVqXHzeVMU6V0yTxy","children":[],"key":"IClOAjqZ9c"}],"key":"sU4pgfh2x9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"6. Merge with Peace River Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VesSqzAcNb"}],"identifier":"id-6-merge-with-peace-river-data","label":"6. Merge with Peace River Data","html_id":"id-6-merge-with-peace-river-data","implicit":true,"key":"SYAureuN6M"}],"key":"XcBlcRqyqh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Load Peace River + atmospheric + ocean features\ndf_peace = pd.read_csv('data_weekly_intepolated.csv', parse_dates=['time'])\n\n# Load Caloosahatchee features\ndf_caloosa = pd.read_csv('caloosa_weekly_with_time.csv', parse_dates=['time'])\n\n# Merge on 'time' column\ndf_swfl_merged = pd.merge(df_peace, df_caloosa, on='time', how='outer')\n\n# Drop rows with missing values\ndf_swfl_merged.dropna(inplace=True)\n\n# Save merged dataset\ndf_swfl_merged.to_csv('swfl_merged_features.csv', index=False)\n\n# Preview merged dataset (optional)\ndf_swfl_merged.head()","key":"IgAZdrhv2j"},{"type":"outputs","id":"kca94KLAzZbymI_kNvLQd","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":35,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>time</th>\n      <th>kb</th>\n      <th>zos</th>\n      <th>salinity</th>\n      <th>water_temp</th>\n      <th>wind_direction</th>\n      <th>wind_speed</th>\n      <th>peace_discharge</th>\n      <th>peace_TN</th>\n      <th>peace_TP</th>\n      <th>caloosa_discharge</th>\n      <th>caloosa_total_nitrogen</th>\n      <th>caloosa_total_phosphorus</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1993-01-04</td>\n      <td>333.0</td>\n      <td>0.012906</td>\n      <td>33.043478</td>\n      <td>26.8</td>\n      <td>36.0</td>\n      <td>13.9</td>\n      <td>202.0</td>\n      <td>8.2000</td>\n      <td>1.999091</td>\n      <td>251.250000</td>\n      <td>1.051607</td>\n      <td>0.070000</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1993-01-11</td>\n      <td>667.0</td>\n      <td>0.015614</td>\n      <td>33.065217</td>\n      <td>27.0</td>\n      <td>118.0</td>\n      <td>16.2</td>\n      <td>423.0</td>\n      <td>10.1000</td>\n      <td>1.934545</td>\n      <td>1528.600000</td>\n      <td>0.778571</td>\n      <td>0.070000</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1993-01-18</td>\n      <td>667.0</td>\n      <td>0.021702</td>\n      <td>33.086957</td>\n      <td>27.1</td>\n      <td>108.0</td>\n      <td>16.2</td>\n      <td>1470.0</td>\n      <td>12.0000</td>\n      <td>1.870000</td>\n      <td>3398.571429</td>\n      <td>0.792937</td>\n      <td>0.067143</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1993-01-25</td>\n      <td>0.0</td>\n      <td>0.015950</td>\n      <td>33.108696</td>\n      <td>26.8</td>\n      <td>110.0</td>\n      <td>12.6</td>\n      <td>1450.0</td>\n      <td>10.0475</td>\n      <td>1.870500</td>\n      <td>2687.000000</td>\n      <td>0.798333</td>\n      <td>0.058000</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1993-02-01</td>\n      <td>0.0</td>\n      <td>0.008977</td>\n      <td>33.130435</td>\n      <td>26.5</td>\n      <td>14.0</td>\n      <td>17.5</td>\n      <td>1490.0</td>\n      <td>8.0950</td>\n      <td>1.871000</td>\n      <td>2979.142857</td>\n      <td>0.765926</td>\n      <td>0.048667</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"        time     kb       zos   salinity  water_temp  wind_direction  \\\n0 1993-01-04  333.0  0.012906  33.043478        26.8            36.0   \n1 1993-01-11  667.0  0.015614  33.065217        27.0           118.0   \n2 1993-01-18  667.0  0.021702  33.086957        27.1           108.0   \n3 1993-01-25    0.0  0.015950  33.108696        26.8           110.0   \n4 1993-02-01    0.0  0.008977  33.130435        26.5            14.0   \n\n   wind_speed  peace_discharge  peace_TN  peace_TP  caloosa_discharge  \\\n0        13.9            202.0    8.2000  1.999091         251.250000   \n1        16.2            423.0   10.1000  1.934545        1528.600000   \n2        16.2           1470.0   12.0000  1.870000        3398.571429   \n3        12.6           1450.0   10.0475  1.870500        2687.000000   \n4        17.5           1490.0    8.0950  1.871000        2979.142857   \n\n   caloosa_total_nitrogen  caloosa_total_phosphorus  \n0                1.051607                  0.070000  \n1                0.778571                  0.070000  \n2                0.792937                  0.067143  \n3                0.798333                  0.058000  \n4                0.765926                  0.048667  ","content_type":"text/plain"}}},"children":[],"key":"OE5Ly8jv7T"}],"key":"kPoyBXjVGe"}],"key":"pjpeInfxu5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_swfl_merged.tail()","key":"EBbNjapkrR"},{"type":"outputs","id":"9Gi1P5GrhPqsRVZTJ_Pjh","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":36,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>time</th>\n      <th>kb</th>\n      <th>zos</th>\n      <th>salinity</th>\n      <th>water_temp</th>\n      <th>wind_direction</th>\n      <th>wind_speed</th>\n      <th>peace_discharge</th>\n      <th>peace_TN</th>\n      <th>peace_TP</th>\n      <th>caloosa_discharge</th>\n      <th>caloosa_total_nitrogen</th>\n      <th>caloosa_total_phosphorus</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1612</th>\n      <td>2023-11-27</td>\n      <td>0.0</td>\n      <td>-0.005114</td>\n      <td>36.0</td>\n      <td>27.110714</td>\n      <td>79.800000</td>\n      <td>11.666667</td>\n      <td>326.0</td>\n      <td>2.0675</td>\n      <td>0.8365</td>\n      <td>1822.857143</td>\n      <td>1.203413</td>\n      <td>0.152143</td>\n    </tr>\n    <tr>\n      <th>1613</th>\n      <td>2023-12-04</td>\n      <td>0.0</td>\n      <td>-0.003981</td>\n      <td>36.0</td>\n      <td>26.992857</td>\n      <td>91.466667</td>\n      <td>12.306667</td>\n      <td>231.0</td>\n      <td>2.1800</td>\n      <td>0.8000</td>\n      <td>1336.571429</td>\n      <td>1.249048</td>\n      <td>0.150464</td>\n    </tr>\n    <tr>\n      <th>1614</th>\n      <td>2023-12-11</td>\n      <td>0.0</td>\n      <td>-0.009013</td>\n      <td>36.0</td>\n      <td>26.528571</td>\n      <td>83.833333</td>\n      <td>12.086667</td>\n      <td>201.0</td>\n      <td>1.8400</td>\n      <td>0.7900</td>\n      <td>1782.857143</td>\n      <td>1.151432</td>\n      <td>0.136031</td>\n    </tr>\n    <tr>\n      <th>1615</th>\n      <td>2023-12-18</td>\n      <td>0.0</td>\n      <td>0.005557</td>\n      <td>36.0</td>\n      <td>26.207143</td>\n      <td>110.433333</td>\n      <td>12.176667</td>\n      <td>460.0</td>\n      <td>2.2080</td>\n      <td>0.9700</td>\n      <td>1845.714286</td>\n      <td>1.038714</td>\n      <td>0.119810</td>\n    </tr>\n    <tr>\n      <th>1616</th>\n      <td>2023-12-25</td>\n      <td>0.0</td>\n      <td>0.001243</td>\n      <td>36.0</td>\n      <td>26.053571</td>\n      <td>92.166667</td>\n      <td>13.396667</td>\n      <td>470.0</td>\n      <td>2.2080</td>\n      <td>0.9700</td>\n      <td>1798.571429</td>\n      <td>1.017036</td>\n      <td>0.111671</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"           time   kb       zos  salinity  water_temp  wind_direction  \\\n1612 2023-11-27  0.0 -0.005114      36.0   27.110714       79.800000   \n1613 2023-12-04  0.0 -0.003981      36.0   26.992857       91.466667   \n1614 2023-12-11  0.0 -0.009013      36.0   26.528571       83.833333   \n1615 2023-12-18  0.0  0.005557      36.0   26.207143      110.433333   \n1616 2023-12-25  0.0  0.001243      36.0   26.053571       92.166667   \n\n      wind_speed  peace_discharge  peace_TN  peace_TP  caloosa_discharge  \\\n1612   11.666667            326.0    2.0675    0.8365        1822.857143   \n1613   12.306667            231.0    2.1800    0.8000        1336.571429   \n1614   12.086667            201.0    1.8400    0.7900        1782.857143   \n1615   12.176667            460.0    2.2080    0.9700        1845.714286   \n1616   13.396667            470.0    2.2080    0.9700        1798.571429   \n\n      caloosa_total_nitrogen  caloosa_total_phosphorus  \n1612                1.203413                  0.152143  \n1613                1.249048                  0.150464  \n1614                1.151432                  0.136031  \n1615                1.038714                  0.119810  \n1616                1.017036                  0.111671  ","content_type":"text/plain"}}},"children":[],"key":"fixqSxyDFb"}],"key":"R4Dao6VwSn"}],"key":"RCjsSNG4QS"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"7. Add Tampa KB Counts","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l8lQxb9gHw"}],"identifier":"id-7-add-tampa-kb-counts","label":"7. Add Tampa KB Counts","html_id":"id-7-add-tampa-kb-counts","implicit":true,"key":"W1hZcQDh2p"}],"key":"iWeuNpxd4T"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\n\n# Load SWFL merged features\ndf_swfl = pd.read_csv('swfl_merged_features.csv', parse_dates=['time'])\n\n# Load full HABSOS dataset\ndf_tampa = pd.read_csv('habsos_20240430.csv', parse_dates=['SAMPLE_DATE'])\n\n# Filter to Tampa Bay region using your specified bounding box\ndf_tampa = df_tampa[\n    (df_tampa['LATITUDE'].between(27.4, 28.2)) &\n    (df_tampa['LONGITUDE'].between(-83.0, -82.3))\n]\n\n# Rename columns for clarity\ndf_tampa.rename(columns={'SAMPLE_DATE': 'time', 'CELLCOUNT': 'kb_tampa'}, inplace=True)\n\n# Group by date to get daily average KB concentration for Tampa region\ndf_tampa_daily = df_tampa.groupby('time', as_index=False)['kb_tampa'].mean()\n\n# Merge with the existing SWFL dataset on 'time'\ndf_swfl_tampa = pd.merge(df_swfl, df_tampa_daily, on='time', how='left')\n\n# Save to new CSV file\ndf_swfl_tampa.to_csv('swfl_merged_features_tampa.csv', index=False)\n\n# Optional: preview the result\ndf_swfl_tampa.head()","key":"dQ8nsGzp9Y"},{"type":"outputs","id":"pIGiwmHSEz_y9JQdSiWJb","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"C:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\3940744265.py:7: DtypeWarning: Columns (21,24) have mixed types. Specify dtype option on import or set low_memory=False.\n  df_tampa = pd.read_csv('habsos_20240430.csv', parse_dates=['SAMPLE_DATE'])\n"},"children":[],"key":"u0KsRc0uJc"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":37,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>time</th>\n      <th>kb</th>\n      <th>zos</th>\n      <th>salinity</th>\n      <th>water_temp</th>\n      <th>wind_direction</th>\n      <th>wind_speed</th>\n      <th>peace_discharge</th>\n      <th>peace_TN</th>\n      <th>peace_TP</th>\n      <th>caloosa_discharge</th>\n      <th>caloosa_total_nitrogen</th>\n      <th>caloosa_total_phosphorus</th>\n      <th>kb_tampa</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1993-01-04</td>\n      <td>333.0</td>\n      <td>0.012906</td>\n      <td>33.043478</td>\n      <td>26.8</td>\n      <td>36.0</td>\n      <td>13.9</td>\n      <td>202.0</td>\n      <td>8.2000</td>\n      <td>1.999091</td>\n      <td>251.250000</td>\n      <td>1.051607</td>\n      <td>0.070000</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1993-01-11</td>\n      <td>667.0</td>\n      <td>0.015614</td>\n      <td>33.065217</td>\n      <td>27.0</td>\n      <td>118.0</td>\n      <td>16.2</td>\n      <td>423.0</td>\n      <td>10.1000</td>\n      <td>1.934545</td>\n      <td>1528.600000</td>\n      <td>0.778571</td>\n      <td>0.070000</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1993-01-18</td>\n      <td>667.0</td>\n      <td>0.021702</td>\n      <td>33.086957</td>\n      <td>27.1</td>\n      <td>108.0</td>\n      <td>16.2</td>\n      <td>1470.0</td>\n      <td>12.0000</td>\n      <td>1.870000</td>\n      <td>3398.571429</td>\n      <td>0.792937</td>\n      <td>0.067143</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1993-01-25</td>\n      <td>0.0</td>\n      <td>0.015950</td>\n      <td>33.108696</td>\n      <td>26.8</td>\n      <td>110.0</td>\n      <td>12.6</td>\n      <td>1450.0</td>\n      <td>10.0475</td>\n      <td>1.870500</td>\n      <td>2687.000000</td>\n      <td>0.798333</td>\n      <td>0.058000</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1993-02-01</td>\n      <td>0.0</td>\n      <td>0.008977</td>\n      <td>33.130435</td>\n      <td>26.5</td>\n      <td>14.0</td>\n      <td>17.5</td>\n      <td>1490.0</td>\n      <td>8.0950</td>\n      <td>1.871000</td>\n      <td>2979.142857</td>\n      <td>0.765926</td>\n      <td>0.048667</td>\n      <td>0.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"        time     kb       zos   salinity  water_temp  wind_direction  \\\n0 1993-01-04  333.0  0.012906  33.043478        26.8            36.0   \n1 1993-01-11  667.0  0.015614  33.065217        27.0           118.0   \n2 1993-01-18  667.0  0.021702  33.086957        27.1           108.0   \n3 1993-01-25    0.0  0.015950  33.108696        26.8           110.0   \n4 1993-02-01    0.0  0.008977  33.130435        26.5            14.0   \n\n   wind_speed  peace_discharge  peace_TN  peace_TP  caloosa_discharge  \\\n0        13.9            202.0    8.2000  1.999091         251.250000   \n1        16.2            423.0   10.1000  1.934545        1528.600000   \n2        16.2           1470.0   12.0000  1.870000        3398.571429   \n3        12.6           1450.0   10.0475  1.870500        2687.000000   \n4        17.5           1490.0    8.0950  1.871000        2979.142857   \n\n   caloosa_total_nitrogen  caloosa_total_phosphorus  kb_tampa  \n0                1.051607                  0.070000       0.0  \n1                0.778571                  0.070000       NaN  \n2                0.792937                  0.067143       NaN  \n3                0.798333                  0.058000       NaN  \n4                0.765926                  0.048667       0.0  ","content_type":"text/plain"}}},"children":[],"key":"takGGyg6cg"}],"key":"GD5MKDHzSk"}],"key":"YYPntYlidL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_swfl_tampa['kb_tampa'] = df_swfl_tampa['kb_tampa'].fillna(0)","key":"zbt9gZz96E"},{"type":"outputs","id":"e-cZtGQri3W8xTMzVw-nO","children":[],"key":"V5NfeeoU0U"}],"key":"iFAN6abAmV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_swfl_tampa.to_csv('swfl_merged_features_tampa.csv', index=False)\ndf_swfl_tampa.head()","key":"PfzJtUuWbg"},{"type":"outputs","id":"1-r69Z7gBkGjMfn__RY4V","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":39,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>time</th>\n      <th>kb</th>\n      <th>zos</th>\n      <th>salinity</th>\n      <th>water_temp</th>\n      <th>wind_direction</th>\n      <th>wind_speed</th>\n      <th>peace_discharge</th>\n      <th>peace_TN</th>\n      <th>peace_TP</th>\n      <th>caloosa_discharge</th>\n      <th>caloosa_total_nitrogen</th>\n      <th>caloosa_total_phosphorus</th>\n      <th>kb_tampa</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1993-01-04</td>\n      <td>333.0</td>\n      <td>0.012906</td>\n      <td>33.043478</td>\n      <td>26.8</td>\n      <td>36.0</td>\n      <td>13.9</td>\n      <td>202.0</td>\n      <td>8.2000</td>\n      <td>1.999091</td>\n      <td>251.250000</td>\n      <td>1.051607</td>\n      <td>0.070000</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1993-01-11</td>\n      <td>667.0</td>\n      <td>0.015614</td>\n      <td>33.065217</td>\n      <td>27.0</td>\n      <td>118.0</td>\n      <td>16.2</td>\n      <td>423.0</td>\n      <td>10.1000</td>\n      <td>1.934545</td>\n      <td>1528.600000</td>\n      <td>0.778571</td>\n      <td>0.070000</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1993-01-18</td>\n      <td>667.0</td>\n      <td>0.021702</td>\n      <td>33.086957</td>\n      <td>27.1</td>\n      <td>108.0</td>\n      <td>16.2</td>\n      <td>1470.0</td>\n      <td>12.0000</td>\n      <td>1.870000</td>\n      <td>3398.571429</td>\n      <td>0.792937</td>\n      <td>0.067143</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1993-01-25</td>\n      <td>0.0</td>\n      <td>0.015950</td>\n      <td>33.108696</td>\n      <td>26.8</td>\n      <td>110.0</td>\n      <td>12.6</td>\n      <td>1450.0</td>\n      <td>10.0475</td>\n      <td>1.870500</td>\n      <td>2687.000000</td>\n      <td>0.798333</td>\n      <td>0.058000</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1993-02-01</td>\n      <td>0.0</td>\n      <td>0.008977</td>\n      <td>33.130435</td>\n      <td>26.5</td>\n      <td>14.0</td>\n      <td>17.5</td>\n      <td>1490.0</td>\n      <td>8.0950</td>\n      <td>1.871000</td>\n      <td>2979.142857</td>\n      <td>0.765926</td>\n      <td>0.048667</td>\n      <td>0.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"        time     kb       zos   salinity  water_temp  wind_direction  \\\n0 1993-01-04  333.0  0.012906  33.043478        26.8            36.0   \n1 1993-01-11  667.0  0.015614  33.065217        27.0           118.0   \n2 1993-01-18  667.0  0.021702  33.086957        27.1           108.0   \n3 1993-01-25    0.0  0.015950  33.108696        26.8           110.0   \n4 1993-02-01    0.0  0.008977  33.130435        26.5            14.0   \n\n   wind_speed  peace_discharge  peace_TN  peace_TP  caloosa_discharge  \\\n0        13.9            202.0    8.2000  1.999091         251.250000   \n1        16.2            423.0   10.1000  1.934545        1528.600000   \n2        16.2           1470.0   12.0000  1.870000        3398.571429   \n3        12.6           1450.0   10.0475  1.870500        2687.000000   \n4        17.5           1490.0    8.0950  1.871000        2979.142857   \n\n   caloosa_total_nitrogen  caloosa_total_phosphorus  kb_tampa  \n0                1.051607                  0.070000       0.0  \n1                0.778571                  0.070000       0.0  \n2                0.792937                  0.067143       0.0  \n3                0.798333                  0.058000       0.0  \n4                0.765926                  0.048667       0.0  ","content_type":"text/plain"}}},"children":[],"key":"w8bE2ig1px"}],"key":"Eylv79PcZv"}],"key":"aRtHLM71hn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Add kb_tampa values to kb\ndf_swfl_tampa['kb'] = df_swfl_tampa['kb'] + df_swfl_tampa['kb_tampa']\n\n# Drop the kb_tampa column\ndf_swfl_tampa.drop(columns=['kb_tampa'], inplace=True)\ndf_swfl_tampa.to_csv('swfl_merged_features_tampa.csv', index=False)\ndf_swfl_tampa.head()","key":"tTVVVkP3Qj"},{"type":"outputs","id":"Ggz2ZWCULC_-GX5zhT5VZ","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":40,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>time</th>\n      <th>kb</th>\n      <th>zos</th>\n      <th>salinity</th>\n      <th>water_temp</th>\n      <th>wind_direction</th>\n      <th>wind_speed</th>\n      <th>peace_discharge</th>\n      <th>peace_TN</th>\n      <th>peace_TP</th>\n      <th>caloosa_discharge</th>\n      <th>caloosa_total_nitrogen</th>\n      <th>caloosa_total_phosphorus</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1993-01-04</td>\n      <td>333.0</td>\n      <td>0.012906</td>\n      <td>33.043478</td>\n      <td>26.8</td>\n      <td>36.0</td>\n      <td>13.9</td>\n      <td>202.0</td>\n      <td>8.2000</td>\n      <td>1.999091</td>\n      <td>251.250000</td>\n      <td>1.051607</td>\n      <td>0.070000</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1993-01-11</td>\n      <td>667.0</td>\n      <td>0.015614</td>\n      <td>33.065217</td>\n      <td>27.0</td>\n      <td>118.0</td>\n      <td>16.2</td>\n      <td>423.0</td>\n      <td>10.1000</td>\n      <td>1.934545</td>\n      <td>1528.600000</td>\n      <td>0.778571</td>\n      <td>0.070000</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1993-01-18</td>\n      <td>667.0</td>\n      <td>0.021702</td>\n      <td>33.086957</td>\n      <td>27.1</td>\n      <td>108.0</td>\n      <td>16.2</td>\n      <td>1470.0</td>\n      <td>12.0000</td>\n      <td>1.870000</td>\n      <td>3398.571429</td>\n      <td>0.792937</td>\n      <td>0.067143</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1993-01-25</td>\n      <td>0.0</td>\n      <td>0.015950</td>\n      <td>33.108696</td>\n      <td>26.8</td>\n      <td>110.0</td>\n      <td>12.6</td>\n      <td>1450.0</td>\n      <td>10.0475</td>\n      <td>1.870500</td>\n      <td>2687.000000</td>\n      <td>0.798333</td>\n      <td>0.058000</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1993-02-01</td>\n      <td>0.0</td>\n      <td>0.008977</td>\n      <td>33.130435</td>\n      <td>26.5</td>\n      <td>14.0</td>\n      <td>17.5</td>\n      <td>1490.0</td>\n      <td>8.0950</td>\n      <td>1.871000</td>\n      <td>2979.142857</td>\n      <td>0.765926</td>\n      <td>0.048667</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"        time     kb       zos   salinity  water_temp  wind_direction  \\\n0 1993-01-04  333.0  0.012906  33.043478        26.8            36.0   \n1 1993-01-11  667.0  0.015614  33.065217        27.0           118.0   \n2 1993-01-18  667.0  0.021702  33.086957        27.1           108.0   \n3 1993-01-25    0.0  0.015950  33.108696        26.8           110.0   \n4 1993-02-01    0.0  0.008977  33.130435        26.5            14.0   \n\n   wind_speed  peace_discharge  peace_TN  peace_TP  caloosa_discharge  \\\n0        13.9            202.0    8.2000  1.999091         251.250000   \n1        16.2            423.0   10.1000  1.934545        1528.600000   \n2        16.2           1470.0   12.0000  1.870000        3398.571429   \n3        12.6           1450.0   10.0475  1.870500        2687.000000   \n4        17.5           1490.0    8.0950  1.871000        2979.142857   \n\n   caloosa_total_nitrogen  caloosa_total_phosphorus  \n0                1.051607                  0.070000  \n1                0.778571                  0.070000  \n2                0.792937                  0.067143  \n3                0.798333                  0.058000  \n4                0.765926                  0.048667  ","content_type":"text/plain"}}},"children":[],"key":"vIRXeoNqfz"}],"key":"HIIZ9UzjnV"}],"key":"anb6hKcC5H"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"8. Create Combined Data Series","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZpUi6vnc5i"}],"identifier":"id-8-create-combined-data-series","label":"8. Create Combined Data Series","html_id":"id-8-create-combined-data-series","implicit":true,"key":"AXLsAEr3By"}],"key":"lZsx6zvcf7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport matplotlib.dates as mdates\n\n# -----------------------------\n# Load merged weekly dataset\n# -----------------------------\n# If df_swfl_tampa already exists in your notebook, you can comment this out.\ndf = df_swfl_tampa.copy()\n\n# Ensure time is datetime + sorted\ndf[\"time\"] = pd.to_datetime(df[\"time\"])\ndf = df.sort_values(\"time\")\n\n# Keep only columns we need (and coerce to numeric where applicable)\ncols = [\n    \"time\",\n    \"kb\",\n    \"zos\",\n    \"salinity\",\n    \"water_temp\",\n    \"wind_direction\",\n    \"wind_speed\",\n    \"peace_discharge\",\n    \"caloosa_discharge\",\n    \"peace_TN\",\n    \"caloosa_total_nitrogen\",\n    \"peace_TP\",\n    \"caloosa_total_phosphorus\",\n]\ndf_plot = df[cols].copy()\n\nfor c in cols:\n    if c != \"time\":\n        df_plot[c] = pd.to_numeric(df_plot[c], errors=\"coerce\")\n\n# -----------------------------\n# Optional: match ML-ready behavior (drop rows with missing values)\n# -----------------------------\ndf_plot = df_plot.dropna()\n\n# -----------------------------\n# Output path\n# -----------------------------\nout_dir = r\"C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Parameters\"\nos.makedirs(out_dir, exist_ok=True)\nout_path = os.path.join(out_dir, \"stacked_parameters_9panel.png\")\n\n# -----------------------------\n# Plot setup (9 stacked panels)\n# -----------------------------\nfig, axes = plt.subplots(\n    nrows=9,\n    ncols=1,\n    figsize=(14, 22),\n    sharex=True,\n    constrained_layout=True\n)\n\n# 1) Karenia brevis Cell Count\naxes[0].plot(df_plot[\"time\"], df_plot[\"kb\"], linewidth=1.0)\naxes[0].set_title(\"K.brevis Cell Count\")\naxes[0].set_ylabel(\"Cells L$^{-1}$\")\n\n# 2) Sea Surface Height (zos)\naxes[1].plot(df_plot[\"time\"], df_plot[\"zos\"], linewidth=1.0)\naxes[1].set_title(\"Sea Surface Height Anomaly (zos)\")\naxes[1].set_ylabel(\"SSH (m)\")\n\n# 3) Salinity\naxes[2].plot(df_plot[\"time\"], df_plot[\"salinity\"], linewidth=1.0)\naxes[2].set_title(\"Salinity\")\naxes[2].set_ylabel(\"Salinity (PSU)\")\n\n# 4) Water Temperature\naxes[3].plot(df_plot[\"time\"], df_plot[\"water_temp\"], linewidth=1.0)\naxes[3].set_title(\"Water Temperature\")\naxes[3].set_ylabel(\"Temp (°C)\")\n\n# 5) Wind Direction\naxes[4].plot(df_plot[\"time\"], df_plot[\"wind_direction\"], linewidth=1.0)\naxes[4].set_title(\"Wind Direction\")\naxes[4].set_ylabel(\"Direction (°)\")\naxes[4].set_ylim(0, 360)\n\n# 6) Wind Speed\naxes[5].plot(df_plot[\"time\"], df_plot[\"wind_speed\"], linewidth=1.0)\naxes[5].set_title(\"Wind Speed\")\naxes[5].set_ylabel(\"Speed (m s$^{-1}$)\")\n\n# 7) Peace + Caloosa Discharge (cfs)\naxes[6].plot(df_plot[\"time\"], df_plot[\"peace_discharge\"], linewidth=1.0, label=\"Peace River\")\naxes[6].plot(df_plot[\"time\"], df_plot[\"caloosa_discharge\"], linewidth=1.0, label=\"Caloosahatchee River\")\naxes[6].set_title(\"River Discharge\")\naxes[6].set_ylabel(\"Discharge (cfs)\")\naxes[6].legend(loc=\"upper left\", frameon=False)\n\n# 8) Peace + Caloosa Total Nitrogen (mg/L)\naxes[7].plot(df_plot[\"time\"], df_plot[\"peace_TN\"], linewidth=1.0, label=\"Peace River TN\")\naxes[7].plot(df_plot[\"time\"], df_plot[\"caloosa_total_nitrogen\"], linewidth=1.0, label=\"Caloosahatchee TN\")\naxes[7].set_title(\"Total Nitrogen\")\naxes[7].set_ylabel(\"TN (mg/L)\")\naxes[7].legend(loc=\"upper left\", frameon=False)\n\n# 9) Peace + Caloosa Total Phosphorus (mg/L)\naxes[8].plot(df_plot[\"time\"], df_plot[\"peace_TP\"], linewidth=1.0, label=\"Peace River TP\")\naxes[8].plot(df_plot[\"time\"], df_plot[\"caloosa_total_phosphorus\"], linewidth=1.0, label=\"Caloosahatchee TP\")\naxes[8].set_title(\"Total Phosphorus\")\naxes[8].set_ylabel(\"TP (mg/L)\")\naxes[8].legend(loc=\"upper left\", frameon=False)\n\n# -----------------------------\n# X-axis formatting\n# -----------------------------\naxes[8].set_xlabel(\"Time\")\naxes[8].xaxis.set_major_locator(mdates.YearLocator(base=2))\naxes[8].xaxis.set_major_formatter(mdates.DateFormatter(\"%Y\"))\n\nfor ax in axes:\n    ax.grid(True, linewidth=0.5)\n\n# -----------------------------\n# Save figure\n# -----------------------------\nfig.suptitle(\"Combined Environmental Drivers\", y=1.01, fontsize=14)\nplt.savefig(out_path, dpi=300, bbox_inches=\"tight\")\nplt.show()\n\nprint(f\"Saved figure to: {out_path}\")","key":"XLss99kUkd"},{"type":"outputs","id":"MZhsmFwSwwXVNjcq4AYwU","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e538796ac0462dcad1212d024fc2b46d","path":"/red-tide-book//build/e538796ac0462dcad1212d024fc2b46d.png"},"text/plain":{"content":"<Figure size 1400x2200 with 9 Axes>","content_type":"text/plain"}}},"children":[],"key":"EmZPLWqM4v"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Saved figure to: C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Parameters\\stacked_parameters_9panel.png\n"},"children":[],"key":"Ovnu3uI9I0"}],"key":"HxsFdb6v1Z"}],"key":"zvVaWsxrGF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_swfl_tampa[['time', 'caloosa_total_nitrogen']] \\\n    .sort_values('caloosa_total_nitrogen', ascending=False) \\\n    .head(5)","key":"nMEioJJ531"},{"type":"outputs","id":"NE1mRNMEPKOMydhhM0AuO","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":42,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>time</th>\n      <th>caloosa_total_nitrogen</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>351</th>\n      <td>1999-09-27</td>\n      <td>85.896245</td>\n    </tr>\n    <tr>\n      <th>350</th>\n      <td>1999-09-20</td>\n      <td>83.198769</td>\n    </tr>\n    <tr>\n      <th>349</th>\n      <td>1999-09-13</td>\n      <td>73.401286</td>\n    </tr>\n    <tr>\n      <th>348</th>\n      <td>1999-09-06</td>\n      <td>63.663516</td>\n    </tr>\n    <tr>\n      <th>352</th>\n      <td>1999-10-04</td>\n      <td>62.848939</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"          time  caloosa_total_nitrogen\n351 1999-09-27               85.896245\n350 1999-09-20               83.198769\n349 1999-09-13               73.401286\n348 1999-09-06               63.663516\n352 1999-10-04               62.848939","content_type":"text/plain"}}},"children":[],"key":"RanxMtyxhH"}],"key":"PpKaIIQ0VC"}],"key":"Z2XYSs2CMt"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"9. Plot Study Area","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eSwFLEjPtH"}],"identifier":"id-9-plot-study-area","label":"9. Plot Study Area","html_id":"id-9-plot-study-area","implicit":true,"key":"qyIDYQKRt1"}],"key":"Dt8xn7dJpH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\n\n# --------------------------------------------------\n# Load HABsOS bloom observation dataset\n# --------------------------------------------------\ndf_hab = pd.read_csv(\n    \"habsos_20240430.csv\",\n    parse_dates=[\"SAMPLE_DATE\"]\n)\n\nprint(\"Initial HABsOS shape:\", df_hab.shape)\n\n# --------------------------------------------------\n# Filter to Karenia brevis only\n# --------------------------------------------------\ndf_hab = df_hab[\n    (df_hab['GENUS'] == 'Karenia') &\n    (df_hab['SPECIES'] == 'brevis')\n]\n\nprint(\"After filtering to Karenia brevis:\", df_hab.shape)\n\n# --------------------------------------------------\n# Filter to SWFL + Tampa Bay spatial domain\n# --------------------------------------------------\ndf_hab_swfl = df_hab[\n    (df_hab['LATITUDE'].between(24.5, 28.5)) &    # SWFL → Tampa Bay\n    (df_hab['LONGITUDE'].between(-84.5, -80.0)) &\n    (df_hab['SAMPLE_DATE'] >= '1992-01-01')\n]\n\nprint(\"After spatial/temporal filtering:\", df_hab_swfl.shape)\n\n# --------------------------------------------------\n# Create bloom intensity subsets for plotting\n# --------------------------------------------------\nhigh = df_hab_swfl[df_hab_swfl['CELLCOUNT'] >= 1e6]\n\nmedium = df_hab_swfl[\n    (df_hab_swfl['CELLCOUNT'] >= 1e5) &\n    (df_hab_swfl['CELLCOUNT'] < 1e6)\n]\n\nlow = df_hab_swfl[\n    (df_hab_swfl['CELLCOUNT'] >= 1e4) &\n    (df_hab_swfl['CELLCOUNT'] < 1e5)\n]\n\n# --------------------------------------------------\n# Sanity checks\n# --------------------------------------------------\nprint(\"\\nBloom category counts:\")\nprint(f\"  High (≥1e6): {len(high)}\")\nprint(f\"  Medium (1e5–1e6): {len(medium)}\")\nprint(f\"  Low (1e4–1e5): {len(low)}\")\n\nprint(\"\\nCELLCOUNT summary:\")\nprint(df_hab_swfl['CELLCOUNT'].describe())","key":"tKPaLE1Gb3"},{"type":"outputs","id":"Q1mWOH9BJ_k5COOzLiB-T","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"C:\\Users\\mkduu\\AppData\\Local\\Temp\\ipykernel_112204\\1022535847.py:6: DtypeWarning: Columns (21,24) have mixed types. Specify dtype option on import or set low_memory=False.\n  df_hab = pd.read_csv(\n"},"children":[],"key":"qJ4fgHlDxX"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Initial HABsOS shape: (211834, 28)\nAfter filtering to Karenia brevis: (211834, 28)\nAfter spatial/temporal filtering: (143120, 28)\n\nBloom category counts:\n  High (≥1e6): 2665\n  Medium (1e5–1e6): 7882\n  Low (1e4–1e5): 8879\n\nCELLCOUNT summary:\ncount    1.431200e+05\nmean     1.359387e+05\nstd      2.403858e+06\nmin      0.000000e+00\n25%      0.000000e+00\n50%      0.000000e+00\n75%      0.000000e+00\nmax      3.884000e+08\nName: CELLCOUNT, dtype: float64\n"},"children":[],"key":"eJa5cZfdNH"}],"key":"jZD0kXGb5J"}],"key":"x3sfqAsuQm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Recreate KB (Karenia brevis) cellcount map up to Tampa Bay (Cartopy)\n# Assumes you already have df_hab loaded (HABsOS) with at least:\n# ['LATITUDE','LONGITUDE','SAMPLE_DATE','CELLCOUNT','GENUS','SPECIES'].\n# If df_hab is not in memory yet, load it first like we did earlier.\n\nimport os\nfrom pathlib import Path\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\nimport cartopy.crs as ccrs\nimport cartopy.feature as cfeature\nfrom matplotlib.patches import Rectangle\n\n# -----------------------\n# 0) Output folder\n# -----------------------\noutput_dir = Path(r\"C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Tampa_Data_Graphics\")\noutput_dir.mkdir(parents=True, exist_ok=True)\n\n# -----------------------\n# 1) Map extent + focus box (SWFL->Tampa)\n# -----------------------\n# Big Gulf view (similar feel to advisor figure)\nextent = [-98, -79, 22, 30]  # [Lon_W, Lon_E, Lat_S, Lat_N]\n\n# Focus box you can tweak (covers Naples -> Tampa Bay)\nbox_lon_w, box_lon_e = -83.6, -81.1\nbox_lat_s, box_lat_n = 25.3, 28.4\n\n# -----------------------\n# 2) Filter HABsOS to K. brevis + time + focus region (for plotting points)\n# -----------------------\ndf_plot = df_hab.copy()\n\n# Ensure datetime\ndf_plot[\"SAMPLE_DATE\"] = pd.to_datetime(df_plot[\"SAMPLE_DATE\"], errors=\"coerce\")\n\n# Keep Karenia brevis only (robust to case/spacing)\ndf_plot = df_plot[\n    df_plot[\"GENUS\"].astype(str).str.strip().str.lower().eq(\"karenia\") &\n    df_plot[\"SPECIES\"].astype(str).str.strip().str.lower().eq(\"brevis\")\n].copy()\n\n# Time filter (matches your earlier workflow)\ndf_plot = df_plot[df_plot[\"SAMPLE_DATE\"] >= pd.to_datetime(\"1992-01-01\")].copy()\n\n# Keep only points inside the focus box (so we don’t paint the whole Gulf with dots)\ndf_plot = df_plot[\n    (df_plot[\"LONGITUDE\"].between(box_lon_w, box_lon_e)) &\n    (df_plot[\"LATITUDE\"].between(box_lat_s, box_lat_n))\n].copy()\n\n# Make sure CELLCOUNT is numeric\ndf_plot[\"CELLCOUNT\"] = pd.to_numeric(df_plot[\"CELLCOUNT\"], errors=\"coerce\").fillna(0)\n\n# Categories\nhigh = df_plot[df_plot[\"CELLCOUNT\"] >= 1e6]\nmedium = df_plot[(df_plot[\"CELLCOUNT\"] >= 1e5) & (df_plot[\"CELLCOUNT\"] < 1e6)]\nlow = df_plot[(df_plot[\"CELLCOUNT\"] >= 1e4) & (df_plot[\"CELLCOUNT\"] < 1e5)]\n\n# -----------------------\n# 3) Build map\n# -----------------------\nproj = ccrs.PlateCarree()\nfig = plt.figure(figsize=(11, 8.5))\nax = plt.subplot(1, 1, 1, projection=proj)\nax.set_extent(extent, crs=proj)\n\n# Background / features\nax.set_facecolor(cfeature.COLORS[\"water\"])\nax.add_feature(cfeature.LAKES.with_scale(\"10m\"), color=\"aqua\", zorder=2)\nax.add_feature(cfeature.COASTLINE.with_scale(\"10m\"), color=\"gray\", zorder=3)\nax.add_feature(cfeature.BORDERS, edgecolor=\"red\", facecolor=\"none\", linewidth=1.5, zorder=3)\nax.stock_img()\n\nax.add_feature(\n    cfeature.NaturalEarthFeature(\n        \"physical\", \"rivers_lake_centerlines\", scale=\"10m\", edgecolor=\"blue\", facecolor=\"none\"\n    ),\n    zorder=3,\n)\nax.add_feature(\n    cfeature.NaturalEarthFeature(\n        \"physical\", \"rivers_north_america\", scale=\"10m\", edgecolor=\"blue\", facecolor=\"none\", alpha=0.4\n    ),\n    zorder=3,\n)\n\n# Gridlines\ngl = ax.gridlines(\n    draw_labels=True,\n    xlocs=np.arange(extent[0], extent[1] + 1, 5),\n    ylocs=np.arange(extent[2], extent[3] + 1, 5),\n    linewidth=1,\n    color=\"gray\",\n    alpha=0.5,\n    linestyle=\"--\",\n    zorder=10,\n)\ngl.right_labels = False\ngl.top_labels = False\ngl.xlabel_style = {\"size\": 10}\ngl.ylabel_style = {\"size\": 10}\n\n# Bathymetry “bands” (Natural Earth)\nbathymetry_names = [\n    \"bathymetry_L_0\",\n    \"bathymetry_K_200\",\n    \"bathymetry_J_1000\",\n    \"bathymetry_I_2000\",\n    \"bathymetry_H_3000\",\n    \"bathymetry_G_4000\",\n]\n# Very light -> darker blue\nbath_colors = [\n    (0.90, 0.95, 1.00),\n    (0.75, 0.88, 1.00),\n    (0.60, 0.80, 1.00),\n    (0.45, 0.72, 1.00),\n    (0.25, 0.62, 1.00),\n    (0.05, 0.52, 1.00),\n]\nfor name, col in zip(bathymetry_names, bath_colors):\n    ax.add_feature(\n        cfeature.NaturalEarthFeature(\n            category=\"physical\",\n            name=name,\n            scale=\"10m\",\n            edgecolor=\"none\",\n            facecolor=col,\n        ),\n        zorder=1,\n    )\n\n# Focus box rectangle\nrect = Rectangle(\n    (box_lon_w, box_lat_s),\n    box_lon_e - box_lon_w,\n    box_lat_n - box_lat_s,\n    fill=False,\n    linewidth=1.5,\n    edgecolor=\"black\",\n    transform=proj,\n    zorder=20,\n)\nax.add_patch(rect)\n\n# Cities + buoy\nlocations = {\n    \"Tampa\": (27.9506, -82.4572),\n    \"Naples\": (26.1420, -81.7948),\n}\nfor name, (lat, lon) in locations.items():\n    ax.plot(lon, lat, marker=\"o\", color=\"black\", markersize=3, transform=proj, zorder=30)\n    ax.text(lon + 0.15, lat + 0.10, name, transform=proj, fontsize=9, color=\"black\", zorder=30)\n\nbuoys = {\"Buoy 42003\": (25.9253, -85.6161)}\nfor name, (lat, lon) in buoys.items():\n    ax.plot(lon, lat, marker=\"o\", color=\"black\", markersize=3, transform=proj, zorder=30)\n    ax.text(lon - 2.0, lat + 0.10, name, transform=proj, fontsize=9, color=\"black\", zorder=30)\n\n# -----------------------\n# 4) Plot KB points (cellcount bins)\n# -----------------------\nsc_high = ax.scatter(\n    high[\"LONGITUDE\"], high[\"LATITUDE\"],\n    s=10, color=\"red\", edgecolor=\"none\",\n    transform=proj, zorder=40\n)\nsc_med = ax.scatter(\n    medium[\"LONGITUDE\"], medium[\"LATITUDE\"],\n    s=10, color=\"orange\", edgecolor=\"none\",\n    transform=proj, zorder=39\n)\nsc_low = ax.scatter(\n    low[\"LONGITUDE\"], low[\"LATITUDE\"],\n    s=10, color=\"yellow\", edgecolor=\"none\",\n    transform=proj, zorder=38\n)\n\nlegend = ax.legend(\n    handles=[sc_high, sc_med, sc_low],\n    labels=[\"Cellcount ≥ 1e6\", \"1e5 ≤ Cellcount < 1e6\", \"1e4 ≤ Cellcount < 1e5\"],\n    loc=\"upper left\",\n    fontsize=9,\n    frameon=True,\n)\nlegend.set_zorder(50)\n\n# -----------------------\n# 5) Save + show\n# -----------------------\nfname = f\"KB_cellcount_SWFL_Tampa_{pd.Timestamp.now():%Y-%m-%d_%H-%M-%S}.png\"\noutpath = output_dir / fname\nplt.savefig(outpath, dpi=300, bbox_inches=\"tight\")\nprint(f\"Figure saved to: {outpath}\")\n\nplt.show()","key":"O1gBaJYw3R"},{"type":"outputs","id":"ZoKmi2eMaAkiN5_KRj_m_","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"C:\\Users\\mkduu\\miniconda3\\Lib\\site-packages\\cartopy\\mpl\\feature_artist.py:144: UserWarning: facecolor will have no effect as it has been defined as \"never\".\n  warnings.warn('facecolor will have no effect as it has been '\n"},"children":[],"key":"OyKMzq2JVp"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Figure saved to: C:\\Users\\mkduu\\OneDrive\\Documents\\FGCU docs\\Summer 25 Red Tide Project\\Graphics\\Tampa_Data_Graphics\\KB_cellcount_SWFL_Tampa_2025-12-29_15-58-53.png\n"},"children":[],"key":"IACpn9HXMB"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d58140171c0b2c16f04b898b36a2c84f","path":"/red-tide-book//build/d58140171c0b2c16f04b898b36a2c84f.png"},"text/plain":{"content":"<Figure size 1100x850 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"uyPMu6oOFh"}],"key":"RPXMPAvVtG"}],"key":"ONDFFuawX6"}],"key":"nWZ1I8IVB3"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Red Tide Data and Modeling Book","url":"/","group":"Red Tide Data and Modeling Book"},"next":{"title":"Watershed Study Area","url":"/watershed-graphics","group":"Red Tide Data and Modeling Book"}}},"domain":"http://localhost:3000"}